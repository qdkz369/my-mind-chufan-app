# é”™è¯¯è¾“å‡ºè§„èŒƒ

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

**`console.error` åªèƒ½ç”¨äºçœŸæ­£çš„ç³»ç»Ÿé”™è¯¯ï¼Œä¸èƒ½ç”¨äºå¯é¢„æœŸçš„ä¸šåŠ¡å¤±è´¥ã€‚**

---

## âœ… å…è®¸ä½¿ç”¨ console.error çš„æƒ…å†µ

### A. ç³»ç»Ÿä¸å¯æ¢å¤é”™è¯¯ï¼ˆçœŸæ­£çš„ bug / crashï¼‰

ä»¥ä¸‹æƒ…å†µ**å¿…é¡»**ä½¿ç”¨ `console.error`ï¼š

1. **ç¨‹åºé€»è¾‘ä¸å¯èƒ½æ¢å¤**
   - React Error Boundary æ•è·çš„é”™è¯¯
   - æœªæ•è·çš„å¼‚å¸¸å¯¼è‡´ç»„ä»¶å´©æºƒ
   - å†…å­˜æº¢å‡ºã€æ ˆæº¢å‡ºç­‰ç³»ç»Ÿçº§é”™è¯¯

2. **æ•°æ®ç»“æ„è¿åäº‹å®çº¦æŸ**
   - è®¢å•äº‹å®ä¸ç¬¦åˆå¥‘çº¦ï¼ˆ`order_fact` è¿åçº¦æŸï¼‰
   - æ•°æ®åº“è¿”å›çš„æ•°æ®ç»“æ„ä¸ç¬¦åˆé¢„æœŸï¼ˆç±»å‹é”™è¯¯ï¼‰
   - å…³é”®ä¸šåŠ¡æ•°æ®ç¼ºå¤±å¯¼è‡´æ— æ³•ç»§ç»­æ‰§è¡Œ

3. **Invariant / Assert å¤±è´¥**
   - æ–­è¨€å¤±è´¥ï¼ˆ`invariant(false, "message")`ï¼‰
   - ç±»å‹æ£€æŸ¥å¤±è´¥ï¼ˆTypeScript ç±»å‹ä¸åŒ¹é…ï¼‰
   - å…³é”®é…ç½®ç¼ºå¤±ï¼ˆSupabase æœªåˆå§‹åŒ–ã€ç¯å¢ƒå˜é‡ç¼ºå¤±ï¼‰

### ç¤ºä¾‹

```typescript
// âœ… æ­£ç¡®ï¼šç³»ç»Ÿçº§é”™è¯¯
if (!supabase) {
  console.error("[ç³»ç»Ÿé”™è¯¯] Supabase æœªåˆå§‹åŒ–ï¼Œæ— æ³•ç»§ç»­")
  throw new Error("Supabase æœªåˆå§‹åŒ–")
}

// âœ… æ­£ç¡®ï¼šæ•°æ®çº¦æŸè¿å
if (!orderFact.accepted_at || !orderFact.completed_at) {
  console.error("[è®¢å•äº‹å®API] è®¢å•äº‹å®ä¸ç¬¦åˆå¥‘çº¦:", validation.errors)
  return NextResponse.json({ success: false, error: "æ•°æ®çº¦æŸè¿å" }, { status: 500 })
}

// âœ… æ­£ç¡®ï¼šError Boundary æ•è·çš„é”™è¯¯
componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
  console.error("[ErrorBoundary] æ•è·åˆ°é”™è¯¯:", error)
  console.error("[ErrorBoundary] é”™è¯¯ä¿¡æ¯:", errorInfo)
}
```

---

## âŒ ç¦æ­¢ä½¿ç”¨ console.error çš„æƒ…å†µ

### B. å¯é¢„æœŸä¸šåŠ¡å¤±è´¥ï¼ˆæœªç™»å½•ã€æ— æƒé™ã€æ— æ•°æ®ï¼‰

ä»¥ä¸‹æƒ…å†µ**ç¦æ­¢**ä½¿ç”¨ `console.error`ï¼Œåº”ä½¿ç”¨ `logBusinessWarning` æˆ– `console.warn`ï¼š

1. **æƒé™å¤±è´¥ï¼ˆ401 / 403ï¼‰**
   - ç”¨æˆ·æœªç™»å½•
   - ç”¨æˆ·æ— æƒé™è®¿é—®èµ„æº
   - RLS ç­–ç•¥æ‹’ç»è®¿é—®

2. **ç½‘ç»œå¤±è´¥**
   - API è¯·æ±‚è¶…æ—¶
   - ç½‘ç»œè¿æ¥å¤±è´¥
   - æœåŠ¡å™¨è¿”å› 5xx é”™è¯¯ï¼ˆä½†å‰ç«¯å·²åšé™çº§å¤„ç†ï¼‰

3. **æ•°æ®ä¸ºç©º**
   - æŸ¥è¯¢ç»“æœä¸ºç©º
   - ç”¨æˆ·å°šæœªåˆ›å»ºæ•°æ®
   - åˆ—è¡¨ä¸ºç©ºï¼ˆæ­£å¸¸ä¸šåŠ¡çŠ¶æ€ï¼‰

4. **ViewModel è½¬æ¢å¤±è´¥**
   - Facts â†’ ViewModel è½¬æ¢å¤±è´¥
   - æ•°æ®æ ¼å¼ä¸åŒ¹é…ï¼ˆä½†å·²åšé™çº§å¤„ç†ï¼‰
   - éƒ¨åˆ†æ•°æ®ç¼ºå¤±ï¼ˆä¸å½±å“å…¶ä»–åŠŸèƒ½ï¼‰

5. **Feature å°šæœªå¯ç”¨**
   - åŠŸèƒ½å¼€å…³å…³é—­
   - ç”¨æˆ·æœªå¼€é€šåŠŸèƒ½
   - å®éªŒæ€§åŠŸèƒ½æœªæ¿€æ´»

### ç¤ºä¾‹

```typescript
// âŒ é”™è¯¯ï¼šæƒé™éªŒè¯å¤±è´¥æ˜¯é¢„æœŸçš„ä¸šåŠ¡åœºæ™¯
if (response.status === 401 || response.status === 403) {
  console.error('[User Bound Page] æƒé™éªŒè¯å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²ç™»å½•')
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ logBusinessWarning
if (response.status === 401 || response.status === 403) {
  logBusinessWarning('User Bound Page', 'æƒé™éªŒè¯å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²ç™»å½•')
}

// âŒ é”™è¯¯ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥æ˜¯å¸¸è§çš„ä¸šåŠ¡åœºæ™¯
catch (error) {
  console.error('[User Bound Page] è·å–é¤å…äº‹å®æ€»è§ˆå¤±è´¥:', error)
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ logBusinessWarning
catch (error) {
  logBusinessWarning('User Bound Page', 'è·å–é¤å…äº‹å®æ€»è§ˆå¤±è´¥', error)
}

// âŒ é”™è¯¯ï¼šViewModel è½¬æ¢å¤±è´¥ä¸å½±å“å…¶ä»–åŠŸèƒ½
catch (error) {
  console.error('[User Bound Page] è½¬æ¢èµ„äº§å¡ç‰‡ ViewModel å¤±è´¥:', error)
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ console.warn
catch (error) {
  console.warn('[User Bound Page] è½¬æ¢èµ„äº§å¡ç‰‡ ViewModel å¤±è´¥:', error)
}
```

---

## ğŸ”§ æ¨èæ›¿ä»£æ–¹æ¡ˆ

### 1. logBusinessWarningï¼ˆæ¨èï¼‰

ç”¨äº B ç±»é”™è¯¯ï¼ˆå¯é¢„æœŸä¸šåŠ¡å¤±è´¥ï¼‰ã€‚

**ä½ç½®**ï¼š`lib/utils/logger.ts`

```typescript
/**
 * ä¸šåŠ¡è­¦å‘Šæ—¥å¿—å·¥å…·
 * 
 * ç”¨äºè®°å½•å¯é¢„æœŸçš„ä¸šåŠ¡å¤±è´¥ï¼ˆBç±»é”™è¯¯ï¼‰
 * ä¸ä¼šè§¦å‘ Cursor çš„é”™è¯¯ç›‘æ§å¼¹çª—
 */
export function logBusinessWarning(context: string, message: string, details?: any) {
  console.warn(`[${context}] ${message}`, details || '')
}
```

**ä½¿ç”¨æ–¹å¼**ï¼š

```typescript
import { logBusinessWarning } from "@/lib/utils/logger"

// æƒé™éªŒè¯å¤±è´¥
logBusinessWarning('User Bound Page', 'æƒé™éªŒè¯å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²ç™»å½•')

// ç½‘ç»œè¯·æ±‚å¤±è´¥
logBusinessWarning('User Bound Page', 'è·å–é¤å…äº‹å®æ€»è§ˆå¤±è´¥', error)

// æ•°æ®ä¸ºç©º
logBusinessWarning('User Bound Page', 'æœªæ‰¾åˆ° restaurantIdï¼Œæ— æ³•åŠ è½½äº‹å®æ•°æ®')
```

### 2. console.warn

ç”¨äº C ç±»é”™è¯¯ï¼ˆViewModel è½¬æ¢å¤±è´¥ã€æ•°æ®é€‚é…å¤±è´¥ï¼‰ã€‚

**ä½¿ç”¨æ–¹å¼**ï¼š

```typescript
// ViewModel è½¬æ¢å¤±è´¥
catch (error) {
  console.warn('[User Bound Page] è½¬æ¢èµ„äº§å¡ç‰‡ ViewModel å¤±è´¥:', error)
}

// æ•°æ®æ ¼å¼ä¸åŒ¹é…ï¼ˆä½†å·²åšé™çº§å¤„ç†ï¼‰
catch (error) {
  console.warn('[User Bound Page] æ•°æ®æ ¼å¼ä¸åŒ¹é…ï¼Œä½¿ç”¨é»˜è®¤å€¼:', error)
}
```

---

## ğŸ“Š é”™è¯¯åˆ†ç±»å†³ç­–æ ‘

```
é‡åˆ°é”™è¯¯
  â”‚
  â”œâ”€ æ˜¯å¦å¯¼è‡´ç¨‹åºå´©æºƒï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ console.error (Aç±»)
  â”‚   â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­
  â”‚
  â”œâ”€ æ˜¯å¦è¿åæ•°æ®çº¦æŸï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ console.error (Aç±»)
  â”‚   â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­
  â”‚
  â”œâ”€ æ˜¯å¦å¯é¢„æœŸçš„ä¸šåŠ¡å¤±è´¥ï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ logBusinessWarning (Bç±»)
  â”‚   â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­
  â”‚
  â””â”€ æ˜¯å¦ ViewModel è½¬æ¢å¤±è´¥ï¼Ÿ
      â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ console.warn (Cç±»)
      â””â”€ å¦ â†’ ä½¿ç”¨ console.error (Aç±»ï¼Œé»˜è®¤)
```

---

## ğŸš« å¸¸è§è¯¯ç”¨åœºæ™¯

### è¯¯ç”¨ 1ï¼šæƒé™éªŒè¯å¤±è´¥

```typescript
// âŒ é”™è¯¯
if (response.status === 401) {
  console.error('æƒé™éªŒè¯å¤±è´¥')
}

// âœ… æ­£ç¡®
if (response.status === 401) {
  logBusinessWarning('Context', 'æƒé™éªŒè¯å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²ç™»å½•')
}
```

### è¯¯ç”¨ 2ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥

```typescript
// âŒ é”™è¯¯
catch (error) {
  console.error('è·å–æ•°æ®å¤±è´¥:', error)
}

// âœ… æ­£ç¡®
catch (error) {
  logBusinessWarning('Context', 'è·å–æ•°æ®å¤±è´¥', error)
}
```

### è¯¯ç”¨ 3ï¼šæ•°æ®ä¸ºç©º

```typescript
// âŒ é”™è¯¯
if (!data) {
  console.error('æ•°æ®ä¸ºç©º')
}

// âœ… æ­£ç¡®
if (!data) {
  console.warn('æ•°æ®ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å€¼')
  // æˆ–
  logBusinessWarning('Context', 'æ•°æ®ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å€¼')
}
```

### è¯¯ç”¨ 4ï¼šViewModel è½¬æ¢å¤±è´¥

```typescript
// âŒ é”™è¯¯
catch (error) {
  console.error('è½¬æ¢ ViewModel å¤±è´¥:', error)
}

// âœ… æ­£ç¡®
catch (error) {
  console.warn('è½¬æ¢ ViewModel å¤±è´¥ï¼Œè·³è¿‡è¯¥æ•°æ®é¡¹:', error)
}
```

---

## ğŸ“ ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

åœ¨æäº¤ PR å‰ï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

- [ ] æ˜¯å¦ä½¿ç”¨äº† `console.error`ï¼Ÿ
  - [ ] å¦‚æœæ˜¯ï¼Œæ˜¯å¦å±äº A ç±»é”™è¯¯ï¼ˆç³»ç»Ÿä¸å¯æ¢å¤ï¼‰ï¼Ÿ
  - [ ] å¦‚æœæ˜¯ B ç±»é”™è¯¯ï¼Œæ˜¯å¦å·²æ”¹ä¸º `logBusinessWarning`ï¼Ÿ
  - [ ] å¦‚æœæ˜¯ C ç±»é”™è¯¯ï¼Œæ˜¯å¦å·²æ”¹ä¸º `console.warn`ï¼Ÿ

- [ ] æ˜¯å¦å¯¼å…¥äº† `logBusinessWarning`ï¼Ÿ
  - [ ] å¦‚æœä½¿ç”¨äº† `logBusinessWarning`ï¼Œæ˜¯å¦å·²å¯¼å…¥ï¼Ÿ

- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œæ•´ï¼Ÿ
  - [ ] æ˜¯å¦æœ‰é™çº§å¤„ç†ï¼Ÿ
  - [ ] æ˜¯å¦ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Ÿ

---

## ğŸ”„ è¿ç§»è®¡åˆ’

### é˜¶æ®µ 1ï¼šå»ºç«‹è§„èŒƒï¼ˆå·²å®Œæˆï¼‰
- âœ… åˆ›å»º `docs/error-policy.md`
- âœ… åˆ›å»º `lib/utils/logger.ts`
- âœ… åˆ†æ `app/user-bound/page.tsx`

### é˜¶æ®µ 2ï¼šä¿®å¤ user-bound é¡µé¢ï¼ˆè¿›è¡Œä¸­ï¼‰
- â³ ä¿®å¤ `app/user-bound/page.tsx` çš„æ‰€æœ‰ console.error

### é˜¶æ®µ 3ï¼šé€æ­¥è¿ç§»å…¶ä»–é¡µé¢
- â³ `components/profile-content.tsx`
- â³ `app/worker/page.tsx`
- â³ `app/(admin)/dashboard/page.tsx`
- â³ å…¶ä»–é¡µé¢...

### é˜¶æ®µ 4ï¼šAPI è·¯ç”±ä¼˜åŒ–
- â³ ä¼˜åŒ– API è·¯ç”±çš„é”™è¯¯å¤„ç†
- â³ ç¡®ä¿ API è¿”å›ç»“æ„åŒ–çš„é”™è¯¯å“åº”

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/user-bound-console-error-analysis.md` - user-bound é¡µé¢é”™è¯¯åˆ†æ
- `docs/user-bound-error-strategy-replacement-example.md` - é”™è¯¯ç­–ç•¥æ›¿æ¢ç¤ºä¾‹
- `docs/console-error-global-inventory.md` - å…¨å±€ console.error æ¸…å•

---

## âš ï¸ é‡è¦æé†’

**è¿™ä¸æ˜¯"å½¢å¼ä¸»ä¹‰"ï¼Œè€Œæ˜¯é˜²æ­¢ç³»ç»Ÿå›é€€ã€‚**

- æ¯æ¬¡ä½¿ç”¨ `console.error` å‰ï¼Œå…ˆé—®è‡ªå·±ï¼šè¿™æ˜¯çœŸæ­£çš„ç³»ç»Ÿé”™è¯¯å—ï¼Ÿ
- å¦‚æœæ˜¯å¯é¢„æœŸçš„ä¸šåŠ¡å¤±è´¥ï¼Œä½¿ç”¨ `logBusinessWarning` æˆ– `console.warn`
- åœ¨ä»£ç å®¡æŸ¥æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ `console.error` è¯¯ç”¨
- å®šæœŸå›é¡¾å’Œæ›´æ–°æœ¬è§„èŒƒ

---

## ğŸ¯ ç›®æ ‡

**æœ€ç»ˆç›®æ ‡**ï¼šæ‰€æœ‰å¯é¢„æœŸçš„ä¸šåŠ¡å¤±è´¥éƒ½ä¸å†è§¦å‘ Cursor çš„é”™è¯¯ç›‘æ§å¼¹çª—ï¼Œåªæœ‰çœŸæ­£çš„ç³»ç»Ÿé”™è¯¯æ‰ä¼šæ˜¾ç¤ºå¼¹çª—ã€‚
