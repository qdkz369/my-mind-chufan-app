# 2025-01-28 ä»Šæ—¥å·¥ä½œæˆæœ

## ğŸ“‹ æ€»ä½“æˆæœ

**âœ… ç”Ÿäº§æ„å»ºï¼ˆnpm run buildï¼‰å…¨éƒ¨é€šè¿‡**

- Next.js 16 (Turbopack) ç¼–è¯‘æˆåŠŸ
- TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- é™æ€é¡µé¢ç”Ÿæˆå®Œæˆï¼ˆ108/108ï¼‰
- æ—  TypeScript æŠ¥é”™ã€æ— æ„å»ºå¤±è´¥

---

## ğŸ”§ æœ¬æ¬¡ä¿®æ”¹æ‘˜è¦

### 1. è®¢å•äº‹å®æ²»ç†å±‚ç±»å‹ç»Ÿä¸€ï¼ˆ`lib/facts/governance/order.fact.guard.ts`ï¼‰

**é—®é¢˜**ï¼š  
`FactWarning` åœ¨æ²»ç†å±‚å†…é‡å¤å®šä¹‰ï¼Œä¸”ç¼ºå°‘ `detected_at`ã€`restaurant_id`ã€`worker_id`ã€`device_id` ç­‰å­—æ®µï¼Œå¯¼è‡´æ„å»ºæŠ¥é”™ï¼š  
`Object literal may only specify known properties, and 'detected_at' does not exist in type 'FactWarning'.`

**å¤„ç†**ï¼š
- åˆ é™¤æœ¬æ–‡ä»¶å†…çš„ `FactWarning`ã€`FactWarningLevel`ã€`FactWarningDomain`ã€`FactWarningCode` æœ¬åœ°å®šä¹‰
- ä» `@/lib/facts/types` å¯¼å…¥ä¸Šè¿°ç±»å‹ï¼Œå¹¶ç»§ç»­ `export type { ... }` ä»¥ä¿æŒå¯¹å¤–å¯¼å‡ºä¸å˜

**å…³é”®æ”¹åŠ¨**ï¼š
```typescript
import type {
  FactWarning,
  FactWarningLevel,
  FactWarningDomain,
  FactWarningCode
} from "@/lib/facts/types"

export type { FactWarning, FactWarningLevel, FactWarningDomain, FactWarningCode }
```

### 2. è¡¥å…… getDeviceId è¾…åŠ©å‡½æ•°ï¼ˆ`lib/facts/governance/order.fact.guard.ts`ï¼‰

**é—®é¢˜**ï¼š  
å¤šå¤„ä½¿ç”¨ `getDeviceId(trace.asset_id, assetIdToDeviceIdMap)`ï¼Œä½†æœªå®šä¹‰è¯¥å‡½æ•°ï¼Œå¯¼è‡´ï¼š  
`Cannot find name 'getDeviceId'.`

**å¤„ç†**ï¼š  
åœ¨ `OrderFactGuard` ä¹‹å‰æ–°å¢ `getDeviceId`ï¼Œä» `assetIdToDeviceIdMap` ä¸­æŒ‰ `assetId` å– `device_id`ï¼Œç¼ºåˆ™è¿”å› `null`ã€‚

**æ–°å¢ä»£ç **ï¼š
```typescript
function getDeviceId(
  assetId: string,
  assetIdToDeviceIdMap?: Record<string, string | null>
): string | null {
  if (!assetIdToDeviceIdMap || !assetId) return null
  return assetIdToDeviceIdMap[assetId] ?? null
}
```

### 3. è®¢å•çŠ¶æ€æµè½¬ç±»å‹æ³¨è§£ï¼ˆ`lib/types/order.ts`ï¼‰

**é—®é¢˜**ï¼š  
`OrderStatusFlow` æœªå†™ç±»å‹ï¼Œå¯¼è‡´ `OrderStatusFlow[currentStatus]` å¯èƒ½è¢«æ¨æˆ `never[]`ï¼Œè¿›è€Œå‡ºç°ï¼š  
`Argument of type 'OrderStatus' is not assignable to parameter of type 'never'.`

**å¤„ç†**ï¼š  
ä¸º `OrderStatusFlow` æ˜¾å¼å£°æ˜ä¸º `Record<OrderStatus, OrderStatus[]>`ã€‚

**ä¿®æ”¹**ï¼š
```typescript
export const OrderStatusFlow: Record<OrderStatus, OrderStatus[]> = {
  [OrderStatus.PENDING_INSTALL]: [OrderStatus.PENDING_ACCEPTANCE],
  // ... å…¶ä½™ä¸å˜
  [OrderStatus.COMPLETED]: [],
}
```

---

## ğŸ“ æ¶‰åŠæ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `lib/facts/governance/order.fact.guard.ts` | ä¿®æ”¹ | ç±»å‹ä» types å¯¼å…¥ã€æ–°å¢ getDeviceId |
| `lib/types/order.ts` | ä¿®æ”¹ | OrderStatusFlow å¢åŠ ç±»å‹æ³¨è§£ |

---

## ğŸ“Š æ„å»ºç»“æœï¼ˆæœ¬æ¬¡ä¼šè¯éªŒè¯ï¼‰

```
âœ“ Compiled successfully in 11.2s
âœ“ Finished TypeScript in 19.8s
âœ“ Collecting page data using 7 workers in 1590.1ms
âœ“ Generating static pages using 7 workers (108/108) in 2.5s
âœ“ Finalizing page optimization in 11.1ms
```

- **æ¡†æ¶**ï¼šNext.js 16.0.10 (Turbopack)  
- **é™æ€é¡µ**ï¼š108 ä¸ªå…¨éƒ¨ç”Ÿæˆ  
- **è·¯ç”±**ï¼šapp è·¯ç”±ã€API è·¯ç”±ã€é¡µé¢è·¯ç”±å‡æ­£å¸¸åˆ—å‡º  

---

## ğŸ“Œ ä¸å†å²ä¿®å¤çš„å…³ç³»

ä»Šæ—¥ä¿®æ”¹æ˜¯åœ¨æ­¤å‰å¤šè½® TypeScript/æ„å»ºä¿®å¤åŸºç¡€ä¸Šçš„æ”¶å°¾ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

- å„ç±» `Card` çš„ `semanticLevel` è¡¥å…¨
- `force-visible-wrapper` å†…è”æ ·å¼å»æ‰ `!important`
- Supabase ç©ºå€¼æ£€æŸ¥ï¼ˆheaderã€iot-dashboardã€use-financial-view-permissionï¼‰
- worker ç›¸å…³ç»„ä»¶çš„ç±»å‹ä¸ API ä½¿ç”¨ä¿®æ­£
- facts é€‚é…å±‚ä¸æ²»ç†å±‚å¥‘çº¦å­—æ®µè¡¥å…¨ç­‰  

ä»Šæ—¥æˆæœè¡¨æ˜ï¼š**å½“å‰ä»£ç åº“å·²æ»¡è¶³ç”Ÿäº§æ„å»ºæ‰€éœ€çš„ TypeScript ä¸ Next æ„å»ºè¦æ±‚**ã€‚

---

## ğŸ”œ åç»­å¯é€‰é¡¹

- æŒ‰éœ€è·‘ `npm run build` åšæ—¥å¸¸æ„å»ºæ ¡éªŒ
- è‹¥éœ€æ¥å…¥æˆ–è°ƒæ•´ Google Fontsï¼Œå¯å•ç‹¬å¤„ç†å­—ä½“ä¸ç½‘ç»œé—®é¢˜
- æ–°åŠŸèƒ½å¼€å‘æ—¶ç»§ç»­ä¾èµ– `lib/facts/types` ä¸­çš„äº‹å®ç›¸å…³ç±»å‹å®šä¹‰ï¼Œä¿æŒç±»å‹ä¸€è‡´

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2025-01-28*
