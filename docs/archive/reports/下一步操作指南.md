# ğŸ“‹ è®¾å¤‡ç§Ÿèµç³»ç»Ÿ - åç»­æ“ä½œæŒ‡å—

## âœ… å·²å®Œæˆ
- [x] `rental_orders` è¡¨å·²åˆ›å»ºæˆåŠŸï¼ˆ22ä¸ªå­—æ®µï¼‰

---

## ğŸ”„ æ¥ä¸‹æ¥éœ€è¦åšçš„ï¼ˆæŒ‰é¡ºåºï¼‰

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè®¾å¤‡åˆ†ç±»è¡¨ï¼ˆequipment_categoriesï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦ï¼š** è®¾å¤‡éœ€è¦åˆ†ç±»ï¼ˆå¦‚ï¼šç‚‰ç¶è®¾å¤‡ã€åˆ¶å†·è®¾å¤‡ç­‰ï¼‰

**æ“ä½œæ­¥éª¤ï¼š**
1. åœ¨ Supabase SQL Editor ä¸­è¿è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT EXISTS (
  SELECT FROM information_schema.tables 
  WHERE table_schema = 'public' 
  AND table_name = 'equipment_categories'
) AS table_exists;

-- å¦‚æœè¿”å› falseï¼Œæ‰§è¡Œåˆ›å»ºè„šæœ¬
CREATE TABLE IF NOT EXISTS equipment_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL UNIQUE,
  description TEXT,
  icon VARCHAR(50),
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºè§¦å‘å™¨
CREATE TRIGGER update_equipment_categories_updated_at 
  BEFORE UPDATE ON equipment_categories
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- æ’å…¥åˆå§‹åˆ†ç±»æ•°æ®
INSERT INTO equipment_categories (name, description, icon, sort_order) VALUES
  ('ç‚‰ç¶è®¾å¤‡', 'ç‡ƒæ°”ç¶ã€ç”µç£ç‚‰ã€ç”µé™¶ç‚‰ç­‰', 'Flame', 1),
  ('åˆ¶å†·è®¾å¤‡', 'å†°ç®±ã€å†·æŸœã€åˆ¶å†°æœºç­‰', 'Snowflake', 2),
  ('æ’çƒŸè®¾å¤‡', 'æ²¹çƒŸæœºã€æ’é£æ‰‡ã€å‡€åŒ–å™¨ç­‰', 'Wind', 3),
  ('æ¸…æ´—è®¾å¤‡', 'æ´—ç¢—æœºã€æ¶ˆæ¯’æŸœã€æ¸…æ´—æœºç­‰', 'Droplet', 4),
  ('åŠ å·¥è®¾å¤‡', 'åˆ‡èœæœºã€æ…æ‹Œæœºã€å’Œé¢æœºç­‰', 'Zap', 5),
  ('å­˜å‚¨è®¾å¤‡', 'è´§æ¶ã€å‚¨ç‰©æŸœã€ä¿é²œæŸœç­‰', 'Package', 6),
  ('å…¶ä»–è®¾å¤‡', 'å…¶ä»–åå¨è®¾å¤‡', 'MoreHorizontal', 7)
ON CONFLICT (name) DO NOTHING;

-- éªŒè¯åˆ›å»ºæˆåŠŸ
SELECT 'equipment_categories è¡¨åˆ›å»ºæˆåŠŸï¼' AS message, COUNT(*) AS category_count FROM equipment_categories;
```

---

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè®¾å¤‡è¡¨ï¼ˆequipmentï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦ï¼š** è¿™æ˜¯å®é™…å¯ç§Ÿèµçš„è®¾å¤‡ä¿¡æ¯è¡¨

**æ“ä½œæ­¥éª¤ï¼š**
1. åœ¨ Supabase SQL Editor ä¸­è¿è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT EXISTS (
  SELECT FROM information_schema.tables 
  WHERE table_schema = 'public' 
  AND table_name = 'equipment'
) AS table_exists;

-- å¦‚æœè¿”å› falseï¼Œæ‰§è¡Œåˆ›å»ºè„šæœ¬
CREATE TABLE IF NOT EXISTS equipment (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  category_id UUID REFERENCES equipment_categories(id) ON DELETE SET NULL,
  name VARCHAR(200) NOT NULL,
  brand VARCHAR(100),
  model VARCHAR(100),
  description TEXT,
  specifications JSONB,
  images TEXT[],
  monthly_rental_price DECIMAL(10, 2) NOT NULL,
  daily_rental_price DECIMAL(10, 2),
  deposit_amount DECIMAL(10, 2) DEFAULT 0,
  stock_quantity INTEGER DEFAULT 0,
  available_quantity INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  min_rental_period INTEGER DEFAULT 1,
  max_rental_period INTEGER,
  maintenance_included BOOLEAN DEFAULT true,
  delivery_included BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_equipment_category ON equipment(category_id);
CREATE INDEX IF NOT EXISTS idx_equipment_status ON equipment(status);

-- åˆ›å»ºè§¦å‘å™¨
CREATE TRIGGER update_equipment_updated_at 
  BEFORE UPDATE ON equipment
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- å¯ç”¨ RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰
ALTER TABLE equipment ENABLE ROW LEVEL SECURITY;
ALTER TABLE equipment_categories ENABLE ROW LEVEL SECURITY;

-- åˆ›å»º RLS ç­–ç•¥ï¼ˆå…è®¸æ‰€æœ‰è®¤è¯ç”¨æˆ·æŸ¥çœ‹ï¼‰
CREATE POLICY "Authenticated users can view equipment categories"
  ON equipment_categories FOR SELECT
  TO authenticated
  USING (true);

CREATE POLICY "Authenticated users can view equipment"
  ON equipment FOR SELECT
  TO authenticated
  USING (true);

-- éªŒè¯åˆ›å»ºæˆåŠŸ
SELECT 'equipment è¡¨åˆ›å»ºæˆåŠŸï¼' AS message, COUNT(*) AS column_count 
FROM information_schema.columns 
WHERE table_name = 'equipment';
```

---

### ç¬¬ä¸‰æ­¥ï¼šæ’å…¥ç¤ºä¾‹è®¾å¤‡æ•°æ®ï¼ˆå¯é€‰ä½†æ¨èï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦ï¼š** è¿™æ ·å®¢æˆ·ç«¯æ‰èƒ½çœ‹åˆ°å¯ç§Ÿèµçš„è®¾å¤‡

**æ“ä½œæ­¥éª¤ï¼š**
1. å…ˆè·å–ä¸€ä¸ªåˆ†ç±» IDï¼ˆè¿è¡Œä¸‹é¢çš„æŸ¥è¯¢ï¼‰ï¼š

```sql
-- è·å–åˆ†ç±» ID
SELECT id, name FROM equipment_categories LIMIT 1;
```

2. ä½¿ç”¨è·å–åˆ°çš„åˆ†ç±» IDï¼Œæ’å…¥ç¤ºä¾‹è®¾å¤‡ï¼š

```sql
-- æ’å…¥ç¤ºä¾‹è®¾å¤‡ï¼ˆè¯·å°† 'YOUR_CATEGORY_ID' æ›¿æ¢ä¸ºå®é™…çš„åˆ†ç±» IDï¼‰
INSERT INTO equipment (
  category_id,
  name,
  brand,
  model,
  description,
  monthly_rental_price,
  deposit_amount,
  stock_quantity,
  available_quantity,
  status,
  min_rental_period,
  max_rental_period,
  maintenance_included,
  delivery_included
) VALUES
  (
    (SELECT id FROM equipment_categories WHERE name = 'ç‚‰ç¶è®¾å¤‡' LIMIT 1),
    'å•†ç”¨ç‡ƒæ°”ç¶',
    'æ–¹å¤ª',
    'FT-6BZ',
    '6çœ¼å•†ç”¨ç‡ƒæ°”ç¶ï¼Œç«åŠ›å¼ºåŠ²ï¼Œé€‚åˆä¸­å¤§å‹é¤å…',
    800.00,
    2000.00,
    10,
    8,
    'active',
    3,
    24,
    true,
    true
  ),
  (
    (SELECT id FROM equipment_categories WHERE name = 'åˆ¶å†·è®¾å¤‡' LIMIT 1),
    'åŒé—¨å†·æŸœ',
    'æµ·å°”',
    'BC-215',
    '215å‡åŒé—¨å†·æŸœï¼ŒèŠ‚èƒ½ç¯ä¿ï¼Œé€‚åˆå°å‹é¤å…',
    500.00,
    1500.00,
    15,
    12,
    'active',
    1,
    36,
    true,
    false
  ),
  (
    (SELECT id FROM equipment_categories WHERE name = 'æ’çƒŸè®¾å¤‡' LIMIT 1),
    'å•†ç”¨æ²¹çƒŸæœº',
    'è€æ¿',
    'CXW-200',
    'å¤§å¸åŠ›å•†ç”¨æ²¹çƒŸæœºï¼Œé™éŸ³è®¾è®¡',
    600.00,
    1800.00,
    8,
    6,
    'active',
    3,
    24,
    true,
    true
  );

-- éªŒè¯æ•°æ®æ’å…¥æˆåŠŸ
SELECT name, brand, monthly_rental_price, available_quantity 
FROM equipment 
WHERE status = 'active';
```

---

### ç¬¬å››æ­¥ï¼šæµ‹è¯•åº”ç”¨åŠŸèƒ½

**æ“ä½œæ­¥éª¤ï¼š**

1. **åˆ·æ–°åº”ç”¨é¡µé¢**
   - æ‰“å¼€å®¢æˆ·ç«¯é¡µé¢ï¼š`http://localhost:3000/equipment-rental`
   - åº”è¯¥èƒ½çœ‹åˆ°è®¾å¤‡åˆ†ç±»å’Œè®¾å¤‡åˆ—è¡¨

2. **æµ‹è¯•å®¢æˆ·ç«¯åŠŸèƒ½**
   - âœ… æŸ¥çœ‹è®¾å¤‡åˆ†ç±»
   - âœ… æµè§ˆè®¾å¤‡åˆ—è¡¨
   - âœ… ç‚¹å‡»è®¾å¤‡æŸ¥çœ‹è¯¦æƒ…
   - âœ… å°è¯•æäº¤ç§Ÿèµè®¢å•

3. **æµ‹è¯•ç®¡ç†ç«¯åŠŸèƒ½**
   - âœ… æ‰“å¼€ç®¡ç†åå°ï¼š`http://localhost:3000/(admin)/dashboard`
   - âœ… è¿›å…¥"è®¾å¤‡ç§Ÿèµç®¡ç†"
   - âœ… æŸ¥çœ‹ç§Ÿèµè®¢å•åˆ—è¡¨

4. **æµ‹è¯•å·¥äººç«¯åŠŸèƒ½**
   - âœ… æ‰“å¼€å·¥äººç«¯ï¼š`http://localhost:3000/worker`
   - âœ… è¿›å…¥"è®¾å¤‡äº¤ä»˜åŠ©æ‰‹"
   - âœ… æŸ¥çœ‹å¾…äº¤ä»˜è®¢å•

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

å®Œæˆæ¯ä¸€æ­¥åï¼Œè¿è¡Œè¿™ä¸ªæŸ¥è¯¢æ£€æŸ¥æ‰€æœ‰è¡¨ï¼š

```sql
-- æ£€æŸ¥æ‰€æœ‰ç›¸å…³è¡¨æ˜¯å¦å­˜åœ¨
SELECT 
  table_name,
  CASE 
    WHEN table_name IN ('rental_orders', 'equipment', 'equipment_categories') 
    THEN 'âœ… å·²åˆ›å»º'
    ELSE 'âŒ æœªåˆ›å»º'
  END AS status
FROM information_schema.tables 
WHERE table_schema = 'public' 
  AND table_name IN ('rental_orders', 'equipment', 'equipment_categories')
ORDER BY table_name;
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q: å¦‚æœè¡¨å·²å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ
A: ä½¿ç”¨ `CREATE TABLE IF NOT EXISTS` ä¸ä¼šæŠ¥é”™ï¼Œä¼šè·³è¿‡å·²å­˜åœ¨çš„è¡¨ã€‚

### Q: æ’å…¥æ•°æ®æ—¶æç¤ºå¤–é”®é”™è¯¯ï¼Ÿ
A: ç¡®ä¿å…ˆåˆ›å»ºäº† `equipment_categories` è¡¨å¹¶æ’å…¥äº†åˆ†ç±»æ•°æ®ã€‚

### Q: å®¢æˆ·ç«¯çœ‹ä¸åˆ°è®¾å¤‡ï¼Ÿ
A: æ£€æŸ¥ï¼š
1. `equipment` è¡¨æ˜¯å¦æœ‰æ•°æ®
2. è®¾å¤‡çŠ¶æ€æ˜¯å¦ä¸º `'active'`
3. `available_quantity` æ˜¯å¦å¤§äº 0

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š
1. æ‰§è¡Œåˆ°å“ªä¸€æ­¥äº†
2. é‡åˆ°äº†ä»€ä¹ˆé”™è¯¯ä¿¡æ¯
3. æˆªå›¾æˆ–é”™è¯¯æ—¥å¿—

æˆ‘ä¼šå¸®ä½ è§£å†³ï¼


