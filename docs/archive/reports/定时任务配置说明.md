# 定时任务配置说明

## ✅ 已创建配置

已创建 `vercel.json` 文件，配置了两个定时任务：

1. **逾期账期检测**：每天凌晨 1:00 执行
   - 路径：`/api/cron/check-overdue-billing`
   - Cron表达式：`0 1 * * *`（UTC时间）

2. **逾期设备检测**：每天凌晨 2:00 执行
   - 路径：`/api/cron/check-overdue-rentals`
   - Cron表达式：`0 2 * * *`（UTC时间）

## 📝 Vercel Cron 使用说明

### 部署后生效

1. **自动生效**：将 `vercel.json` 文件提交到仓库后，Vercel 会自动识别并配置定时任务

2. **手动触发测试**：
   - 可以使用 `GET /api/cron/check-overdue-billing?dry_run=true` 测试
   - 可以使用 `GET /api/cron/check-overdue-rentals?dry_run=true` 测试

3. **验证定时任务**：
   - 在 Vercel Dashboard → Project Settings → Cron Jobs 查看
   - 确认两个任务已创建并显示在列表中

## ⚠️ 注意事项

1. **时区问题**：Cron表达式使用的是UTC时间，不是本地时间
   - UTC 1:00 = 北京时间 9:00（夏令时）或 8:00（冬令时）
   - 如需调整，修改 `vercel.json` 中的 `schedule` 字段

2. **环境变量**：确保 `SUPABASE_SERVICE_ROLE_KEY` 已配置
   - 定时任务需要使用 Service Role Key 才能访问所有数据

3. **监控和日志**：
   - Vercel 会在执行日志中记录定时任务的执行情况
   - 建议定期检查执行日志，确保任务正常运行

## 🔄 如果需要修改执行时间

修改 `vercel.json` 中的 `schedule` 字段：

```json
{
  "crons": [
    {
      "path": "/api/cron/check-overdue-billing",
      "schedule": "0 1 * * *"  // 修改这里的时间
    }
  ]
}
```

**Cron表达式格式**：`分钟 小时 日 月 星期`

示例：
- `0 1 * * *` - 每天凌晨 1:00
- `0 */6 * * *` - 每 6 小时
- `0 9 * * 1` - 每周一上午 9:00
