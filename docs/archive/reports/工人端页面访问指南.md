# 工人端页面访问指南

## 📍 基础访问路径

### 主页面
```
http://localhost:3000/worker
```

## 🔐 登录要求

访问工人端页面需要先登录：
1. 打开页面后会自动弹出登录对话框
2. 输入工人ID和手机号进行登录
3. 登录成功后可以访问各个功能模块

## 📱 页面视图说明

工人端页面包含以下视图（通过页面内导航切换）：

### 1. 首页（home）
- **访问方式**: 打开 `/worker` 默认显示
- **功能**: 显示工作台主界面，包含所有功能入口卡片
- **包含功能**:
  - 设备安装登记
  - 燃料配送
  - 待接单订单（仅配送员可见）
  - 故障维修
  - 设备交付助手

### 2. 待接单订单（orders）⭐ **新完成的功能**
- **访问方式**: 
  - 从首页点击"待接单订单"卡片（仅配送员可见）
  - 或直接设置 `currentView="orders"`
- **功能**: 
  - 查看所有待接单的配送订单
  - 按产品类型筛选订单
  - 接单操作（pending -> accepted）
  - 开始配送操作（accepted -> delivering）
  - 完成配送操作（delivering -> completed）
- **订单状态**:
  - `pending` - 待接单（显示"接单"按钮）
  - `accepted` - 已接单（显示"开始配送"按钮）
  - `delivering` - 配送中（显示"完成配送"或"查看详情"按钮）
  - `completed` - 已完成（显示"已完成"徽章）

### 3. 燃料配送（delivery）
- **访问方式**: 从首页点击"燃料配送"卡片
- **功能**: 
  - 订单配送模式：从订单列表选择订单进行配送
  - 设备配送模式：扫描餐厅二维码进行设备配送
  - 配送证明：扫描瓶身二维码并上传配送凭证

### 4. 设备安装登记（install）
- **访问方式**: 从首页点击"设备安装登记"卡片
- **功能**: 
  - 扫码绑定设备
  - 安装登记表单
  - 安装凭证上传

### 5. 故障维修（repair）
- **访问方式**: 从首页点击"故障维修"卡片
- **功能**: 
  - 查看报修工单列表
  - 处理维修工单

### 6. 设备交付助手（rental_delivery）
- **访问方式**: 从首页点击"设备交付助手"卡片
- **功能**: 
  - 设备交付
  - 拍照存证
  - 电子签名

## 🎯 接单流程完整路径

### 方式一：通过首页进入
```
1. 访问: http://localhost:3000/worker
2. 登录（如果未登录）
3. 点击首页的"待接单订单"卡片
4. 进入订单列表页面
5. 点击"接单"按钮 → 订单状态变为"已接单"
6. 点击"开始配送"按钮 → 订单状态变为"配送中"
7. 点击"完成配送"按钮 → 进入配送证明页面
8. 扫描瓶身二维码并上传配送凭证
9. 提交完成 → 订单状态变为"已完成"
```

### 方式二：通过燃料配送进入
```
1. 访问: http://localhost:3000/worker
2. 登录（如果未登录）
3. 点击首页的"燃料配送"卡片
4. 选择"订单配送（推荐）"
5. 从订单列表选择订单
6. 进入配送证明页面
7. 完成配送流程
```

## 🔑 权限说明

### 配送员权限（delivery）
- ✅ 可以访问"待接单订单"
- ✅ 可以访问"燃料配送"
- ✅ 可以接单、派单、完成配送

### 安装工权限（install）
- ✅ 可以访问"设备安装登记"
- ❌ 不能访问"待接单订单"

### 维修工权限（repair）
- ✅ 可以访问"故障维修"
- ❌ 不能访问"待接单订单"

## 📊 订单状态流转图

```
pending（待接单）
    ↓ [点击"接单"]
accepted（已接单）
    ↓ [点击"开始配送"]
delivering（配送中）
    ↓ [点击"完成配送" + 上传凭证]
completed（已完成）
```

## 🧪 测试建议

### 测试接单流程
1. **准备测试数据**:
   - 确保数据库中有 `status='pending'` 的 `delivery_orders` 记录
   - 确保有对应的 `restaurants` 记录

2. **测试步骤**:
   ```
   1. 访问 http://localhost:3000/worker
   2. 使用配送员账号登录（worker_types 包含 'delivery'）
   3. 点击"待接单订单"
   4. 查看订单列表是否正确显示
   5. 点击"接单"按钮
   6. 验证订单状态是否变为"已接单"
   7. 点击"开始配送"按钮
   8. 验证订单状态是否变为"配送中"
   9. 点击"完成配送"按钮
   10. 验证是否进入配送证明页面
   ```

### 测试订单详情显示
1. 在订单列表中查看是否显示：
   - ✅ 订单号
   - ✅ 订单状态徽章
   - ✅ 餐厅名称
   - ✅ 餐厅地址
   - ✅ 餐厅联系方式
   - ✅ 订单金额
   - ✅ 产品类型

2. 在配送证明页面查看是否显示：
   - ✅ 完整订单信息
   - ✅ 餐厅详细信息

## 🐛 常见问题

### Q: 看不到"待接单订单"卡片？
**A**: 检查工人账号的 `worker_types` 是否包含 `'delivery'`

### Q: 订单列表为空？
**A**: 
- 检查数据库中是否有 `status='pending'` 的 `delivery_orders` 记录
- 检查 API `/api/orders/pending` 是否正常返回数据

### Q: 接单失败？
**A**: 
- 检查是否已登录
- 检查 `workerId` 是否正确
- 查看浏览器控制台错误信息
- 检查 API `/api/orders/accept` 是否正常

### Q: 餐厅信息不显示？
**A**: 
- 检查订单的 `restaurant_id` 是否存在
- 检查 `/api/restaurant?id=xxx` 是否正常返回数据
- 查看浏览器控制台网络请求

## 📝 相关文件

- **主页面**: `app/worker/page.tsx`
- **订单列表组件**: `components/worker/order-list.tsx`
- **接单API**: `app/api/orders/accept/route.ts`
- **派单API**: `app/api/orders/dispatch/route.ts`
- **完成API**: `app/api/orders/complete/route.ts`
- **待接单列表API**: `app/api/orders/pending/route.ts`
- **餐厅信息API**: `app/api/restaurant/route.ts`

## 🚀 快速开始

```bash
# 1. 启动开发服务器
npm run dev

# 2. 访问工人端页面
浏览器打开: http://localhost:3000/worker

# 3. 登录配送员账号
- 工人ID: 你的配送员ID
- 手机号: 你的手机号

# 4. 开始测试接单流程
```
