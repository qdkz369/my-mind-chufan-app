# æ£€æŸ¥ company_id å­—æ®µçš„æ–¹æ³•

## âŒ é”™è¯¯åŸå› 

æ‚¨é‡åˆ°çš„é”™è¯¯æ˜¯å› ä¸ºåœ¨ **Supabase SQL Editor** ä¸­æ‰§è¡Œäº†ç»ˆç«¯å‘½ä»¤ã€‚

`npx tsx scripts/check-company-id-fields.ts` æ˜¯ä¸€ä¸ª **Node.js è„šæœ¬**ï¼Œåº”è¯¥åœ¨ **ç»ˆç«¯/å‘½ä»¤è¡Œ** ä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨ SQL ç¼–è¾‘å™¨ä¸­ã€‚

## âœ… æ­£ç¡®çš„æ–¹æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨ SQL è„šæœ¬ï¼ˆæ¨èï¼Œåœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼‰

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ª SQL è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š

**æ–‡ä»¶ï¼š** `migrations/20250122_check_company_id_fields.sql`

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. æ‰“å¼€ Supabase Dashboard
2. è¿›å…¥ SQL Editor
3. å¤åˆ¶ `migrations/20250122_check_company_id_fields.sql` æ–‡ä»¶çš„å†…å®¹
4. ç²˜è´´åˆ° SQL Editor ä¸­
5. ç‚¹å‡» "Run" æ‰§è¡Œ

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… æ£€æŸ¥æ‰€æœ‰è¡¨æ˜¯å¦å­˜åœ¨ `company_id` å­—æ®µ
- âœ… ä»¥è¡¨æ ¼å½¢å¼è¿”å›æ£€æŸ¥ç»“æœ
- âœ… åœ¨ NOTICE æ¶ˆæ¯ä¸­æ˜¾ç¤ºè¯¦ç»†æ¸…å•
- âœ… æä¾›ç¼ºå°‘å­—æ®µçš„ SQL æ·»åŠ ç¤ºä¾‹

### æ–¹æ³• 2ï¼šä½¿ç”¨ Node.js è„šæœ¬ï¼ˆåœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼‰

å¦‚æœæ‚¨æƒ³åœ¨ç»ˆç«¯ä¸­è¿è¡Œ TypeScript è„šæœ¬ï¼š

**æ–‡ä»¶ï¼š** `scripts/check-company-id-fields.ts`

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ
npx tsx scripts/check-company-id-fields.ts
```

**æ³¨æ„ï¼š** 
- éœ€è¦ç¡®ä¿å·²é…ç½®ç¯å¢ƒå˜é‡ `NEXT_PUBLIC_SUPABASE_URL` å’Œ `SUPABASE_SERVICE_ROLE_KEY`
- å¦‚æœ `tsx` æœªå®‰è£…ï¼Œå…ˆè¿è¡Œï¼š`npm install -D tsx`

## ğŸ“‹ æ£€æŸ¥çš„è¡¨åˆ—è¡¨

ä»¥ä¸‹è¡¨ä¼šè¢«æ£€æŸ¥ï¼š
1. `restaurants` - é¤å…è¡¨
2. `orders` - è®¢å•è¡¨
3. `repair_orders` - æŠ¥ä¿®è®¢å•è¡¨
4. `delivery_orders` - é…é€è®¢å•è¡¨
5. `workers` - å·¥äººè¡¨
6. `devices` - è®¾å¤‡è¡¨
7. `service_points` - æœåŠ¡ç‚¹è¡¨
8. `rental_orders` - ç§Ÿèµè®¢å•è¡¨
9. `device_rentals` - è®¾å¤‡ç§Ÿèµè¡¨
10. `fuel_prices` - ç‡ƒæ–™ä»·æ ¼è¡¨

## ğŸ”§ å¦‚æœè¡¨ç¼ºå°‘ company_id å­—æ®µ

å¦‚æœæ£€æŸ¥ç»“æœæ˜¾ç¤ºæŸäº›è¡¨ç¼ºå°‘ `company_id` å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SQL æ·»åŠ ï¼š

```sql
-- ç¤ºä¾‹ï¼šä¸º restaurants è¡¨æ·»åŠ  company_id å­—æ®µ
ALTER TABLE restaurants 
ADD COLUMN IF NOT EXISTS company_id UUID 
REFERENCES companies(id) ON DELETE SET NULL;

-- åˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½
CREATE INDEX IF NOT EXISTS idx_restaurants_company_id 
ON restaurants(company_id);
```

**æ³¨æ„ï¼š** æ ¹æ®å®é™…è¡¨ç»“æ„ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´å¤–é”®å…³ç³»å’Œç´¢å¼•åç§°ã€‚
