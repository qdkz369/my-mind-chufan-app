# 环境变量检查清单

## 问题诊断

终端显示 `使用环境变量 Key: false` 是**正常的**，因为：
- 这个日志来自 `lib/supabase.ts`，检查的是 `NEXT_PUBLIC_SUPABASE_ANON_KEY`（前端配置）
- 我们需要的 `SUPABASE_SERVICE_ROLE_KEY` 是服务器端环境变量，不会在这里显示

## 关键检查点

### 1. `.env.local` 文件位置
文件必须在项目**根目录**（与 `package.json` 同级）

```
my-mind-chufan-app/
├── .env.local          ← 这里！
├── package.json
├── next.config.mjs
└── app/
```

### 2. `.env.local` 文件内容
确保文件内容**完全正确**：

```
SUPABASE_SERVICE_ROLE_KEY=sb_secret_Nf3MT3QFxzXzr60Myh6VwA_K3-II_Nd
```

**注意：**
- ✅ 没有引号
- ✅ 等号前后没有空格
- ✅ 没有多余的空行
- ✅ 文件编码是 UTF-8

### 3. 重启服务器
**必须完全重启**：
1. 按 `Ctrl + C` 停止服务器
2. 等待完全停止
3. 运行 `npm run dev` 重新启动

### 4. 验证配置
重启后，尝试创建供应商，然后查看服务器终端输出，应该能看到：

```
[创建公司API] 环境变量检查:
- SUPABASE_SERVICE_ROLE_KEY 存在: true
- SUPABASE_SERVICE_ROLE_KEY 长度: 51
```

如果显示 `存在: false`，说明环境变量没有被读取。

## 如果仍然失败

请检查：
1. 文件是否真的在根目录（不是子目录）
2. 文件名是否正确（`.env.local`，注意前面的点）
3. 文件是否被 `.gitignore` 忽略（这是正常的，但确保文件存在）
4. 尝试删除 `.next` 文件夹后重新启动


