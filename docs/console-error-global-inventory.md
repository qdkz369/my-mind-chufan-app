# 全局 console.error 使用清单

## 分类统计

### 📄 页面组件（Pages）

#### `app/user-bound/page.tsx` (11处)
- 第 113 行：权限验证失败（401/403）
- 第 116 行：获取餐厅事实总览失败
- 第 138 行：转换资产卡片 ViewModel 失败
- 第 142 行：权限验证失败（401/403）
- 第 145 行：获取关联资产列表失败
- 第 207 行：转换订单时间线 ViewModel 失败
- 第 227 行：转换订单关联资产 ViewModel 失败
- 第 232 行：权限验证失败（401/403）
- 第 236 行：权限验证失败（401/403）
- 第 239 行：获取最近一次配送失败
- 第 243 行：加载事实数据失败

#### `app/worker/page.tsx` (20+处)
- 第 139 行：安装表单验证失败
- 第 146 行：安装表单验证失败
- 第 153 行：安装表单验证失败
- 第 160 行：安装表单验证失败
- 第 222 行：关联设备到客户失败
- 第 230 行：处理设备失败
- 第 257 行：更新餐厅状态失败
- 第 263 行：更新餐厅状态时出错
- 第 290 行：安装表单提交失败
- 第 335 行：获取客户信息失败
- 第 983 行：绑定设备失败
- 第 997 行：更新餐厅状态失败
- 第 1202 行：关联设备到餐厅失败
- 第 1223 行：创建安装订单失败
- 第 1243 行：更新餐厅状态失败
- 第 1643 行：接单失败
- 第 1703 行：操作失败
- 第 2589 行：Supabase 客户端未初始化
- 第 2612 行：Supabase URL 或 Service Role Key 未配置
- 第 2638 行：加载失败
- 第 2644 行：加载失败
- 第 2722 行：提交失败
- 第 3200 行：解析保存的工人信息失败
- 第 3320 行：登录失败

#### `app/payment/page.tsx` (7处)
- 第 270 行：加载上次订单信息失败
- 第 324 行：获取位置信息失败
- 第 346 行：更新配送员位置失败
- 第 454 行：保存商户位置失败
- 第 496 行：保存商户位置失败
- 第 657 行：保存订单信息失败
- 第 707 行：支付处理失败

#### `app/equipment-rental/page.tsx` (5处)
- 第 170 行：加载分类失败
- 第 176 行：加载分类失败
- 第 210 行：加载设备失败
- 第 216 行：加载设备失败
- 第 235 行：加载订单失败
- 第 311 行：提交失败

#### `app/devices/page.tsx` (3处)
- 第 84 行：检查登录状态失败
- 第 143 行：查询设备失败
- 第 241 行：加载设备失败

#### `app/login/page.tsx` (2处)
- 第 61 行：登录失败
- 第 90 行：查询角色失败

#### `app/(admin)/dashboard/page.tsx` (30+处)
- 第 453 行：Geocoder 插件加载失败
- 第 458 行：AMap.plugin 不可用
- 第 514 行：PlaceSearch 插件加载失败
- 第 520 行：AMap.plugin 不可用
- 第 634 行：更新坐标失败
- 第 768 行：加载餐厅数据失败
- 第 824 行：加载餐厅数据时出错
- 第 865 行：加载订单失败
- 第 901 行：加载订单时出错
- 第 964 行：加载所有订单失败
- 第 1002 行：加载所有订单时出错
- 第 1029 行：接口返回错误
- 第 1055 行：加载报修时出错
- 第 1057 行：错误详情
- 第 1140 行：更新报修失败
- 第 1147 行：更新报修后未返回数据
- 第 1175 行：更新报修时出错
- 第 1236 行：设备租赁管理加载失败
- 第 1242 行：设备租赁管理加载失败
- 第 1269 行：设备租赁基础功能加载失败
- 第 1275 行：设备租赁基础功能加载失败
- 第 1301 行：加载设备和餐厅列表失败
- 第 1415 行：加载设备和餐厅列表失败
- 第 1540 行：租赁工作台加载失败
- 第 1785-1788 行：添加工人失败（多行）
- 更多...

#### `app/(admin)/rental/contracts/page.tsx` (4处)
- 第 104 行：权限验证失败
- 第 128 行：加载失败
- 第 146 行：加载餐厅列表失败
- 第 154 行：加载餐厅列表失败

#### `app/(admin)/rental/usage-snapshots/page.tsx` (3处)
- 第 103 行：权限验证失败
- 第 134 行：加载快照列表失败
- 第 171 行：更新状态失败

---

### 🔧 组件（Components）

#### `components/profile-content.tsx` (15处)
- 第 113 行：加载餐厅信息失败
- 第 197 行：定位失败事件
- 第 208 行：加载高德地图插件失败
- 第 247 行：加载统计数据异常
- 第 294 行：解析缓存数据失败
- 第 340 行：Supabase查询失败
- 第 356 行：异常
- 第 467 行：高德逆地理编码异常
- 第 492 行：浏览器原生定位失败
- 第 549 行：定位超时
- 第 577 行：坐标无效
- 第 714 行：逆地理编码异常
- 第 730 行：定位数据格式错误
- 第 744 行：定位失败
- 第 790 行：定位异常
- 第 853 行：注册表单更新失败
- 第 952 行：注册表单更新失败
- 第 976 行：注册表单注册失败
- 第 1034 行：注册表单注册失败
- 第 1039 行：提交失败
- 第 1116 行：登录失败

#### `components/iot-dashboard.tsx` (4处)
- 第 79 行：加载燃料数据失败
- 第 169 行：刷新统计数据失败
- 第 181 行：Realtime 订阅失败
- 第 193 行：达到最大重连次数
- 第 198 行：设置实时订阅失败

#### `components/error-boundary.tsx` (2处)
- 第 41 行：捕获到错误（A类 - 系统错误）
- 第 42 行：错误信息（A类 - 系统错误）

#### `components/worker/repair-list.tsx` (1处)
- 第 190 行：加载维修工单失败

---

### 🔌 API 路由（API Routes）

#### `app/api/facts/orders/[order_id]/route.ts` (4处)
- 第 96 行：查询订单失败
- 第 235 行：查询溯源记录失败
- 第 297 行：查询资产状态失败
- 第 374 行：订单事实不符合契约（A类 - 数据约束违反）
- 第 432 行：处理请求时出错

#### `app/api/facts/restaurant/[restaurant_id]/overview/route.ts` (5处)
- 第 104 行：查询活跃订单失败
- 第 118 行：查询已完成订单失败
- 第 134 行：查询活跃资产失败
- 第 152 行：查询最后一次配送时间失败
- 第 166 行：处理请求时出错

#### `app/api/facts/restaurant/[restaurant_id]/assets/route.ts` (2处)
- 第 95 行：查询设备失败
- 第 155 行：处理请求时出错

#### `app/api/facts/restaurant/[restaurant_id]/latest-order/route.ts` (2处)
- 第 94 行：查询失败
- 第 107 行：处理请求时出错

#### `app/api/facts/restaurant/[restaurant_id]/stats/route.ts` (3处)
- 第 89 行：查询订单数失败
- 第 110 行：查询积分余额失败
- 第 134 行：处理请求时出错

#### `app/api/facts/fuel/[device_id]/stats/route.ts` (4处)
- 第 126 行：查询累计加注量失败
- 第 130 行：查询餐厅数据失败
- 第 157 行：查询燃料历史失败
- 第 179 行：处理请求时出错

#### `app/api/repair/create/route.ts` (多处)
- 创建报修工单失败（RLS 策略错误）
- 创建报修工单失败（通用错误）

#### `app/api/equipment/rental/create/route.ts` (1处)
- 第 179 行：服务器错误

#### `app/api/equipment/rental/admin/list/route.ts` (1处)
- 服务器内部错误（但返回 200）

---

### 🪝 Hooks

#### `hooks/use-financial-view-permission.ts` (1处)
- 第 69 行：金融视图权限检查错误

---

## 分类汇总

### 按类型统计

| 类型 | 数量 | 说明 |
|------|------|------|
| **页面组件** | ~80+ | 用户界面层的错误处理 |
| **API 路由** | ~30+ | 服务端 API 错误处理 |
| **组件** | ~20+ | 可复用组件的错误处理 |
| **Hooks** | 1 | 自定义 Hook 的错误处理 |

### 按语义分类（预估）

| 语义类型 | 数量 | 占比 |
|---------|------|------|
| **B类（可预期业务失败）** | ~100+ | ~80% |
| **C类（ViewModel 转换失败）** | ~10+ | ~8% |
| **A类（系统不可恢复错误）** | ~10+ | ~8% |

---

## 高风险区域

### 1. 高频使用 console.error 的文件

- `app/worker/page.tsx` - 20+ 处
- `app/(admin)/dashboard/page.tsx` - 30+ 处
- `components/profile-content.tsx` - 15+ 处
- `app/user-bound/page.tsx` - 11 处（已规划修复）

### 2. 需要优先处理的文件

1. **`app/user-bound/page.tsx`** - 已分析，待修复
2. **`components/profile-content.tsx`** - 定位、注册、登录相关错误
3. **`app/worker/page.tsx`** - 工人端核心功能
4. **`app/(admin)/dashboard/page.tsx`** - 管理端核心功能

---

## 建议

1. **立即修复**：`app/user-bound/page.tsx`（已规划）
2. **逐步迁移**：其他页面按优先级逐步替换
3. **建立规范**：创建 `docs/error-policy.md` 防止回退
4. **代码审查**：在 PR 中检查是否有新的 `console.error` 误用
