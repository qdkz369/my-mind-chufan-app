# 今日继续计划 - 供应商多租户与功能验证

**日期**: 2026-01-31 续  
**昨日完成**: 供应商导航权限、异常处理数据隔离、控制台警告修复  

---

## 一、昨日完成项 ✅

| 项目 | 状态 | 说明 |
|------|------|------|
| 供应商导航显示 | ✅ | `user_companies` + `company_permissions` 配置后可见 |
| 逾期设备未归还隔离 | ✅ | `/api/cron/check-overdue-rentals` 按 `provider_id` 过滤 |
| 控制台 [Workers]/[Orders] 警告 | ✅ | 补充依赖数组 + `userRole===null` 静默返回 |

---

## 二、今日建议任务

### 1. 多租户数据隔离自查（可选）

供应商可见的 API 已具备隔离逻辑：

| API | 隔离方式 | 状态 |
|-----|----------|------|
| `/api/finance/billing/overdue` | `rental_orders.provider_id` | ✅ |
| `/api/cron/check-overdue-rentals` | `rental_orders.provider_id` | ✅ |
| `/api/equipment/rental/admin/list` | `provider_id` | ✅ |
| `/api/device-rentals/list` | `company_id` (enforceCompanyFilter) | ✅ |
| `/api/repair/list` | 公司餐厅 ID 过滤 | ✅ |
| `/api/agreements` | 公司过滤 | ✅ |
| `/api/finance/report` | `provider_id` | ✅ |
| `/api/equipment/catalog/list` | `provider_id` | ✅ |
| `/api/admin/get-company-permissions` | `user_companies` 校验 | ✅ |

### 2. 功能测试（推荐）

按 `app/(admin)/dashboard/TEST_CHECKLIST.md` 执行：

- [ ] 供应商账号登录，确认左侧导航完整
- [ ] 工作台：总餐厅数、待处理订单、总营收 为 0 或本公司数据
- [ ] 异常处理：逾期账期、逾期设备仅显示本公司
- [ ] 餐厅管理、订单管理、报修管理：仅本公司数据
- [ ] 设备租赁管理、租赁工作台：仅本公司数据
- [ ] 无控制台报错

### 3. 新供应商配置（如需）

为新供应商配置权限时，执行 `scripts/为供应商添加导航权限.sql`，并修改其中的邮箱为实际账号。

---

## 三、后续可选

- 补充 `supplier-management.tsx` 中的 `fetch` 为 `fetchWithAuth`（若供应商需访问）
- 更新 `SPLIT_CHECK_REPORT.md` 与当前代码状态保持一致
