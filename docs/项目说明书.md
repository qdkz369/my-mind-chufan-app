# 项目说明书

**项目名称**：我的智能餐厅 - 商业厨房服务APP（SaaS版本）  
**文档版本**：v1.0  
**生成日期**：2026-01-27  
**项目类型**：多租户餐饮后市场服务平台

---

## 一、项目简介

### 1.1 项目背景

餐饮行业后市场服务长期以来存在服务分散、效率低下、管理困难等问题。传统的燃料配送、设备租赁、维修保养等服务往往由不同的供应商提供，餐厅需要对接多个服务商，管理成本高、效率低。

本项目旨在通过SaaS模式，为餐饮企业提供一站式后市场服务平台，整合燃料配送、设备租赁、维修服务、供应链管理等服务，实现全流程数字化管理。

### 1.2 项目目标

**业务目标**：
- 为餐饮企业提供便捷的一站式后市场服务
- 降低餐厅管理成本，提升服务效率
- 为供应商提供统一的订单管理和客户管理平台
- 实现多角色协同，优化服务流程

**技术目标**：
- 构建稳定、可扩展的SaaS平台
- 实现多租户数据隔离和安全保障
- 提供良好的用户体验和性能
- 支持移动端和桌面端访问

---

## 二、用户角色与功能

### 2.1 客户端（餐厅/商户端）

**用户角色**：餐厅老板、餐厅管理员

**核心功能**：

#### 2.1.1 燃料配送服务
- **下单功能**：支持天然气、液化气、柴油等燃料下单
- **订单跟踪**：实时查看订单状态（待接单、配送中、已完成等）
- **历史记录**：查看历史订单和消费记录
- **地址管理**：管理配送地址，支持高德地图选择

#### 2.1.2 设备租赁服务
- **设备浏览**：浏览可租赁设备（炉灶、冷柜、油烟机等）
- **租赁申请**：提交设备租赁申请
- **租赁管理**：查看租赁合同、支付记录、到期提醒
- **设备归还**：申请设备归还，上传归还凭证

#### 2.1.3 维修服务
- **一键报修**：支持语音录制报修需求
- **工单跟踪**：查看维修工单状态和进度
- **维修历史**：查看历史维修记录
- **评价反馈**：对维修服务进行评价

#### 2.1.4 设备管理
- **设备绑定**：通过二维码扫描绑定设备
- **设备列表**：查看已绑定设备列表
- **设备状态**：查看设备运行状态和统计数据
- **金融视图**：查看设备相关的财务信息（需权限）

#### 2.1.5 订单管理
- **订单列表**：查看所有订单（配送、租赁、维修）
- **订单筛选**：按状态、时间、类型筛选订单
- **订单详情**：查看订单详细信息
- **订单确认**：确认订单完成并支付

#### 2.1.6 其他功能
- **个人资料**：管理个人信息和设置
- **地址管理**：管理配送地址
- **支付管理**：查看支付记录和账单
- **通知中心**：接收系统通知和订单提醒

**访问路径**：
- `/user-bound` - 已绑定用户主页（事实看板）
- `/user-unbound` - 未绑定用户引导页
- `/orders` - 订单列表
- `/devices` - 设备管理
- `/equipment-rental` - 设备租赁
- `/repair/create` - 报修页面
- `/payment` - 支付页面

---

### 2.2 管理端（供应商/平台管理端）

**用户角色**：
- **super_admin** - 超级管理员（系统级）
- **platform_admin** - 平台运营管理员
- **company_admin** - 供应商管理员

**核心功能**：

#### 2.2.1 供应商管理
- **创建供应商**：创建新的供应商公司
- **权限分配**：为供应商分配管理员权限
- **供应商列表**：查看所有供应商信息
- **权限管理**：管理供应商的功能权限

#### 2.2.2 订单管理
- **订单列表**：查看所有订单（按供应商过滤）
- **订单统计**：查看订单统计数据（总数、待处理、已完成等）
- **订单详情**：查看订单详细信息
- **订单操作**：审核订单、分配工人、更新状态

#### 2.2.3 报修工单管理
- **工单列表**：查看所有报修工单
- **工单分配**：将工单分配给维修工人
- **工单跟踪**：跟踪工单处理进度
- **工单统计**：查看工单统计数据

#### 2.2.4 设备租赁管理
- **租赁申请审核**：审核设备租赁申请
- **设备库存管理**：管理可租赁设备库存
- **租赁合同管理**：查看和管理租赁合同
- **使用快照**：查看设备使用快照数据

#### 2.2.5 产品管理
- **产品审核**：审核B2B商城产品上架申请
- **产品列表**：查看所有产品（按供应商过滤）
- **产品分类**：管理产品分类
- **产品统计**：查看产品销售统计

#### 2.2.6 数据看板
- **运营总览**：查看平台运营数据（订单数、完成率、异常率等）
- **异常监控**：监控异常订单和异常工人
- **收入分析**：查看收入统计和分析
- **用户统计**：查看用户增长和活跃度

#### 2.2.7 用户管理
- **用户列表**：查看所有用户（按供应商过滤）
- **用户信息**：查看用户详细信息
- **角色管理**：管理用户角色和权限
- **用户搜索**：搜索和查找用户

**访问路径**：
- `/dashboard` - 管理后台主页
- `/dashboard/supplier-management` - 供应商管理
- `/dashboard/product-approval` - 产品审核
- `/dashboard/agreement-management` - 协议管理

---

### 2.3 员工端（配送员/维修工端）

**用户角色**：
- **delivery** - 配送员
- **repair** - 维修工

**核心功能**：

#### 2.3.1 待接单列表
- **订单列表**：查看待接单的订单列表
- **订单详情**：查看订单详细信息
- **接单操作**：接受或拒绝订单
- **订单筛选**：按类型、距离等筛选订单

#### 2.3.2 我的订单
- **进行中订单**：查看正在处理的订单
- **已完成订单**：查看历史完成的订单
- **订单状态更新**：更新订单状态（开始配送、完成、异常等）
- **异常上报**：上报订单异常情况

#### 2.3.3 配送功能（配送员）
- **导航功能**：使用地图导航到配送地址
- **位置上报**：实时上报配送位置
- **签收确认**：客户签收确认
- **异常处理**：处理配送异常（客户拒收、地址错误等）

#### 2.3.4 维修功能（维修工）
- **工单详情**：查看维修工单详细信息
- **语音播放**：播放客户报修语音
- **工单更新**：更新工单状态和进度
- **完成确认**：确认维修完成

**访问路径**：
- `/worker/orders` - 待接单列表（配送员）
- `/worker/repair-list` - 维修工单列表（维修工）

---

### 2.4 游客端（营销门户）

**用户角色**：未登录用户

**核心功能**：
- **服务介绍**：展示平台提供的服务
- **优势展示**：展示平台优势和价值
- **注册引导**：引导用户注册
- **设备展示**：展示可租赁设备（公开）

**访问路径**：
- `/guest` - 游客主页

---

## 三、核心业务流程

### 3.1 燃料配送流程

```
1. 餐厅下单
   ↓
2. 订单进入待接单状态
   ↓
3. 配送员接单
   ↓
4. 订单状态：accepted（已接单）
   ↓
5. 配送员开始配送
   ↓
6. 订单状态：delivering（配送中）
   ↓
7. 配送员到达，客户确认
   ↓
8. 订单状态：completed（已完成）
   ↓
9. 客户支付
   ↓
10. 订单完成
```

**异常流程**：
- 配送员可上报异常（交通事故、客户拒收等）
- 订单状态转为 `exception`
- 管理员处理异常订单

### 3.2 设备租赁流程

```
1. 餐厅浏览设备目录
   ↓
2. 选择设备，提交租赁申请
   ↓
3. 供应商审核申请
   ↓
4. 创建租赁合同
   ↓
5. 支付押金和首月租金
   ↓
6. 设备交付（工人配送）
   ↓
7. 设备使用中（按月计费）
   ↓
8. 餐厅申请归还
   ↓
9. 设备回收，检查设备状态
   ↓
10. 退还押金（扣除损坏费用）
   ↓
11. 租赁结束
```

### 3.3 维修服务流程

```
1. 餐厅一键报修（语音录制）
   ↓
2. 创建维修工单
   ↓
3. 工单进入待分配状态
   ↓
4. 管理员分配维修工
   ↓
5. 维修工接单
   ↓
6. 维修工查看工单详情和语音
   ↓
7. 维修工上门维修
   ↓
8. 更新工单状态和进度
   ↓
9. 维修完成，客户确认
   ↓
10. 工单完成，客户评价
```

---

## 四、技术特性

### 4.1 多租户架构

**数据隔离**：
- 每个供应商的数据通过 `company_id` / `provider_id` 隔离
- 数据库层面通过RLS策略限制访问
- 应用层面通过 `getUserContext` 统一过滤

**权限隔离**：
- 不同供应商的管理员只能看到自己公司的数据
- 超级管理员可以查看所有数据
- 员工只能看到分配给自己的订单

### 4.2 Facts驱动架构

**核心理念**：
- 将业务事实（Facts）作为唯一数据源
- 所有业务逻辑基于事实推导
- 状态变更可追溯

**优势**：
- 数据一致性：单一事实源
- 可追溯性：所有操作可追溯
- 可扩展性：新功能基于现有Facts扩展

### 4.3 实时数据同步

**Supabase Realtime**：
- 订单状态实时更新
- 设备状态实时同步
- 通知实时推送

**应用场景**：
- 订单状态变更通知
- 设备状态监控
- 实时数据看板

### 4.4 移动端适配

**响应式设计**：
- 支持移动端和桌面端访问
- 自适应布局
- 触摸优化

**PWA支持**：
- 可安装到手机桌面
- 离线缓存支持
- 推送通知支持

---

## 五、安全与隐私

### 5.1 数据安全

**加密传输**：
- 所有API请求使用HTTPS
- 敏感数据加密存储

**数据隔离**：
- 多租户数据完全隔离
- RLS策略确保数据库层面隔离
- 应用层双重验证

### 5.2 访问控制

**身份认证**：
- Supabase Auth统一认证
- JWT Token机制
- 自动Token刷新

**权限控制**：
- RBAC角色权限管理
- 能力权限细粒度控制
- API级别权限验证

### 5.3 审计日志

**操作记录**：
- 所有关键操作记录审计日志
- 包含操作者、操作类型、目标对象
- 支持操作追溯

---

## 六、性能与扩展

### 6.1 性能优化

**前端优化**：
- Next.js自动代码分割
- 图片懒加载
- 组件懒加载

**后端优化**：
- API响应缓存
- 数据库查询优化
- 索引优化

### 6.2 扩展性

**水平扩展**：
- 无状态API设计
- 支持多实例部署
- 数据库连接池管理

**垂直扩展**：
- 数据库性能优化
- 缓存策略
- 异步任务处理

---

## 七、部署与运维

### 7.1 环境要求

**开发环境**：
- Node.js 18+
- npm 或 yarn
- Supabase账号

**生产环境**：
- Vercel或其他Next.js支持平台
- Supabase生产环境
- 环境变量配置

### 7.2 部署步骤

1. **环境变量配置**
   - 配置Supabase URL和密钥
   - 配置其他第三方服务密钥

2. **数据库迁移**
   - 执行数据库迁移脚本
   - 配置RLS策略

3. **构建部署**
   - 运行 `npm run build`
   - 部署到生产环境

4. **验证测试**
   - 验证功能正常
   - 检查权限配置
   - 测试多租户隔离

### 7.3 监控与维护

**监控指标**：
- API响应时间
- 错误率
- 用户活跃度
- 订单完成率

**维护任务**：
- 定期备份数据库
- 更新依赖包
- 修复安全漏洞
- 优化性能

---

## 八、支持与联系

### 8.1 技术支持

**文档资源**：
- 项目架构文档：`docs/项目架构文档.md`
- API参考文档：`docs/4-api-routes-reference-part1.md`
- 数据模型文档：`docs/2-data-schema-part1.md`

**问题反馈**：
- 通过GitHub Issues反馈问题
- 联系项目维护团队

### 8.2 更新日志

**版本历史**：
- v1.0 (2026-01-27) - 初始版本

---

## 附录

### A. 术语表

| 术语 | 说明 |
|------|------|
| SaaS | Software as a Service，软件即服务 |
| RLS | Row Level Security，行级安全策略 |
| RBAC | Role-Based Access Control，基于角色的访问控制 |
| Facts | 业务事实，Facts驱动架构的核心概念 |
| JWT | JSON Web Token，用于身份认证的令牌 |
| PWA | Progressive Web App，渐进式Web应用 |

### B. 相关文档

- `docs/项目架构文档.md` - 详细技术架构文档
- `项目汇报.md` - 项目业务汇报文档
- `docs/1-system-architecture.md` - 系统架构详细文档

---

**文档维护**：本文档应随项目功能更新持续维护，建议每次重大功能发布后更新版本号。
