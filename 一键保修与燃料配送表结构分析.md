# ä¸€é”®ä¿ä¿®ä¸ç‡ƒæ–™é…é€è¡¨ç»“æ„åˆ†ææŠ¥å‘Š

## ğŸ“Š ç»“è®º

**æ˜¯çš„ï¼Œä¸€é”®ä¿ä¿®å’Œç‡ƒæ–™é…é€å…±ç”¨äº† `orders` è¡¨**ï¼Œä½†é€šè¿‡ `service_type` å­—æ®µæ¥åŒºåˆ†ä¸åŒçš„æœåŠ¡ç±»å‹ã€‚

## ğŸ” è¯¦ç»†åˆ†æ

### 1. å…±ç”¨çš„è¡¨ï¼š`orders`

ä¸¤ä¸ªåŠŸèƒ½éƒ½ä½¿ç”¨ `orders` è¡¨æ¥å­˜å‚¨è®¢å•/å·¥å•ä¿¡æ¯ï¼š

#### ä¸€é”®ä¿ä¿®ï¼ˆæŠ¥ä¿®å·¥å•ï¼‰
- **API è·¯å¾„**ï¼š`app/api/repair/create/route.ts`
- **ä½¿ç”¨çš„è¡¨**ï¼š`orders`
- **service_type å€¼**ï¼š
  - `"ç»´ä¿®æœåŠ¡"`ï¼ˆé»˜è®¤ï¼‰
  - `"æ¸…æ´æœåŠ¡"`
  - `"å·¥ç¨‹æ”¹é€ "`
- **ç‰¹æ®Šå­—æ®µ**ï¼š
  - `audio_url` - è¯­éŸ³æŠ¥ä¿®URL
  - `device_id` - è®¾å¤‡IDï¼ˆå¯é€‰ï¼‰
  - `description` - é—®é¢˜æè¿°

#### ç‡ƒæ–™é…é€è®¢å•
- **API è·¯å¾„**ï¼š`app/api/orders/create/route.ts`
- **ä½¿ç”¨çš„è¡¨**ï¼š`orders`
- **service_type å€¼**ï¼š`"ç‡ƒæ–™é…é€"`ï¼ˆé»˜è®¤ï¼‰
- **ç‰¹æ®Šå­—æ®µ**ï¼š
  - `product_type` - äº§å“ç±»å‹
  - `assigned_to` - åˆ†é…çš„é…é€å‘˜ID
  - `worker_id` - é…é€å‘˜IDï¼ˆå…¼å®¹å­—æ®µï¼‰
  - `tracking_code` - æº¯æºç 
  - `proof_image` - é…é€å‡­è¯å›¾ç‰‡

### 2. åŒºåˆ†æ–¹å¼

é€šè¿‡ `service_type` å­—æ®µåŒºåˆ†ï¼š
- **æŠ¥ä¿®å·¥å•**ï¼š`service_type = "ç»´ä¿®æœåŠ¡" | "æ¸…æ´æœåŠ¡" | "å·¥ç¨‹æ”¹é€ "`
- **ç‡ƒæ–™é…é€**ï¼š`service_type = "ç‡ƒæ–™é…é€"`

### 3. é¢å¤–çš„æ—¥å¿—è¡¨

ç‡ƒæ–™é…é€è¿˜æœ‰ä¸“é—¨çš„æ—¥å¿—è¡¨ï¼ˆæŠ¥ä¿®æ²¡æœ‰ï¼‰ï¼š

#### `filling_logs` è¡¨
- **ç”¨é€”**ï¼šè®°å½•é…é€æ“ä½œæ—¥å¿—
- **API**ï¼š`app/api/filling/route.ts`
- **å­—æ®µ**ï¼š
  - `restaurant_id` - é¤å…ID
  - `device_id` - è®¾å¤‡ID
  - `delivery_person` - é…é€å‘˜
  - `operation_type` - æ“ä½œç±»å‹ï¼ˆ`"refill"` æˆ– `"cylinder_change"`ï¼‰
  - `fuel_amount_liters` - ç‡ƒæ–™å‡æ•°ï¼ˆå›ºå®šæ²¹ç®±ï¼‰
  - `cylinder_id` - é’¢ç“¶IDï¼ˆé’¢ç“¶åœºæ™¯ï¼‰
  - `location_address` - ä½ç½®åœ°å€
  - `fuel_batch_id` - ç‡ƒæ–™æ‰¹æ¬¡ID
  - `executed_at` - æ‰§è¡Œæ—¶é—´

#### `delivery_logs` è¡¨
- **ç”¨é€”**ï¼šè®°å½•é…é€æ—¥å¿—ï¼ˆåŒ…å«æ€§èƒ½æ•°æ®ï¼‰
- **API**ï¼š`app/api/delivery/route.ts`
- **å­—æ®µ**ï¼š
  - `device_id` - è®¾å¤‡ID
  - `tank_id` - æ²¹ç®±/é’¢ç“¶ID
  - `container_type` - å®¹å™¨ç±»å‹ï¼ˆ`"fixed_tank"` æˆ– `"mobile_bottle"`ï¼‰
  - `fuel_amount_liters` - ç‡ƒæ–™å‡æ•°
  - `fuel_batch_id` - ç‡ƒæ–™æ‰¹æ¬¡ID
  - `location_address` - ä½ç½®åœ°å€
  - `delivery_person` - é…é€å‘˜
  - `performance_type` - æ€§èƒ½ç±»å‹ï¼ˆ`"volume"` æˆ– `"count"`ï¼‰
  - `performance_value` - æ€§èƒ½å€¼
  - `executed_at` - æ‰§è¡Œæ—¶é—´

## ğŸ“‹ å½“å‰è¡¨ç»“æ„æ€»ç»“

| åŠŸèƒ½ | è®¢å•è¡¨ | æ—¥å¿—è¡¨ | åŒºåˆ†å­—æ®µ |
|------|--------|--------|---------|
| ä¸€é”®ä¿ä¿® | `orders` | æ—  | `service_type = "ç»´ä¿®æœåŠ¡" / "æ¸…æ´æœåŠ¡" / "å·¥ç¨‹æ”¹é€ "` |
| ç‡ƒæ–™é…é€ | `orders` | `filling_logs`<br>`delivery_logs` | `service_type = "ç‡ƒæ–™é…é€"` |

## âš ï¸ æ˜¯å¦éœ€è¦åˆ†å¼€ï¼Ÿ

### å½“å‰è®¾è®¡çš„é—®é¢˜

1. **æ•°æ®æ··åˆ**ï¼šä¸åŒç±»å‹çš„è®¢å•æ··åœ¨ä¸€ä¸ªè¡¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦è¿‡æ»¤ `service_type`
2. **å­—æ®µå†—ä½™**ï¼šæŠ¥ä¿®å·¥å•ä¸éœ€è¦ `product_type`ã€`tracking_code` ç­‰å­—æ®µï¼›ç‡ƒæ–™é…é€ä¸éœ€è¦ `audio_url` ç­‰å­—æ®µ
3. **æ‰©å±•æ€§å·®**ï¼šå¦‚æœæœªæ¥éœ€è¦ä¸ºä¸åŒç±»å‹è®¢å•æ·»åŠ ç‰¹å®šå­—æ®µï¼Œä¼šå¯¼è‡´è¡¨ç»“æ„è‡ƒè‚¿

### å»ºè®®

**å»ºè®®åˆ†å¼€ä¸ºä¸¤ä¸ªè¡¨**ï¼š

1. **`repair_orders` è¡¨**ï¼ˆæŠ¥ä¿®å·¥å•ï¼‰
   - ä¸“é—¨å­˜å‚¨ç»´ä¿®ã€æ¸…æ´ã€å·¥ç¨‹æ”¹é€ å·¥å•
   - å­—æ®µï¼š`id`, `restaurant_id`, `service_type`, `status`, `description`, `audio_url`, `device_id`, `assigned_to`, `amount`, `created_at`, `updated_at` ç­‰

2. **`delivery_orders` è¡¨**ï¼ˆç‡ƒæ–™é…é€è®¢å•ï¼‰
   - ä¸“é—¨å­˜å‚¨ç‡ƒæ–™é…é€è®¢å•
   - å­—æ®µï¼š`id`, `restaurant_id`, `product_type`, `status`, `assigned_to`, `worker_id`, `tracking_code`, `proof_image`, `amount`, `created_at`, `updated_at` ç­‰

3. **ä¿ç•™ `orders` è¡¨**ï¼ˆå¯é€‰ï¼‰
   - ä½œä¸ºé€šç”¨è®¢å•è¡¨ï¼Œç”¨äºå…¶ä»–ç±»å‹çš„è®¢å•ï¼ˆå¦‚è®¾å¤‡ç§Ÿèµç­‰ï¼‰
   - æˆ–è€…å®Œå…¨ç§»é™¤ï¼Œæ‰€æœ‰è®¢å•éƒ½ä½¿ç”¨ä¸“é—¨çš„è¡¨

### è¿ç§»æ–¹æ¡ˆ

å¦‚æœå†³å®šåˆ†å¼€ï¼Œéœ€è¦ï¼š

1. **åˆ›å»ºæ–°è¡¨**ï¼š`repair_orders` å’Œ `delivery_orders`
2. **æ•°æ®è¿ç§»**ï¼šå°†ç°æœ‰ `orders` è¡¨ä¸­çš„æ•°æ®æŒ‰ `service_type` è¿ç§»åˆ°å¯¹åº”è¡¨
3. **ä¿®æ”¹ API**ï¼š
   - `app/api/repair/*` â†’ ä½¿ç”¨ `repair_orders` è¡¨
   - `app/api/orders/*` â†’ ä½¿ç”¨ `delivery_orders` è¡¨
4. **æ›´æ–°æŸ¥è¯¢é€»è¾‘**ï¼šç§»é™¤ `service_type` è¿‡æ»¤ï¼Œç›´æ¥æŸ¥è¯¢å¯¹åº”è¡¨

## ğŸ“ ä»£ç è¯æ®

### æŠ¥ä¿®å·¥å•ä½¿ç”¨ `orders` è¡¨
```typescript
// app/api/repair/create/route.ts (ç¬¬222è¡Œ)
let { data: newRepair, error: createError } = await supabaseClient
  .from("orders")
  .insert(repairData)
```

### ç‡ƒæ–™é…é€è®¢å•ä½¿ç”¨ `orders` è¡¨
```typescript
// app/api/orders/create/route.ts (ç¬¬90è¡Œ)
const { data: newOrder, error: createError } = await supabase
  .from("orders")
  .insert(orderData)
```

### ç‡ƒæ–™é…é€æ—¥å¿—ä½¿ç”¨ä¸“é—¨è¡¨
```typescript
// app/api/filling/route.ts (ç¬¬206è¡Œ)
const { data: logData, error: logError } = await supabase
  .from("filling_logs")
  .insert([...])

// app/api/delivery/route.ts (ç¬¬202è¡Œ)
const { data: logData, error: logError } = await supabase
  .from("delivery_logs")
  .insert([...])
```

## âœ… æ€»ç»“

- âœ… **å·²ç¡®è®¤**ï¼šä¸€é”®ä¿ä¿®å’Œç‡ƒæ–™é…é€å…±ç”¨äº† `orders` è¡¨
- âœ… **åŒºåˆ†æ–¹å¼**ï¼šé€šè¿‡ `service_type` å­—æ®µåŒºåˆ†
- âœ… **æ—¥å¿—è¡¨**ï¼šç‡ƒæ–™é…é€æœ‰ä¸“é—¨çš„æ—¥å¿—è¡¨ï¼ˆ`filling_logs` å’Œ `delivery_logs`ï¼‰ï¼ŒæŠ¥ä¿®æ²¡æœ‰
- âš ï¸ **å»ºè®®**ï¼šè€ƒè™‘åˆ†å¼€ä¸º `repair_orders` å’Œ `delivery_orders` ä¸¤ä¸ªè¡¨ï¼Œæé«˜æ•°æ®æ¸…æ™°åº¦å’Œæ‰©å±•æ€§
