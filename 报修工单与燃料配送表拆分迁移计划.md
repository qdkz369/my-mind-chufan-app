# æŠ¥ä¿®å·¥å•ä¸ç‡ƒæ–™é…é€è¡¨æ‹†åˆ†è¿ç§»è®¡åˆ’

## ğŸ“‹ è¿ç§»ç›®æ ‡

å°†å…±ç”¨çš„ `orders` è¡¨æ‹†åˆ†ä¸ºï¼š
1. **`repair_orders`** - æŠ¥ä¿®å·¥å•è¡¨ï¼ˆç»´ä¿®æœåŠ¡ã€æ¸…æ´æœåŠ¡ã€å·¥ç¨‹æ”¹é€ ï¼‰
2. **`delivery_orders`** - ç‡ƒæ–™é…é€è®¢å•è¡¨

## ğŸ¯ è¿ç§»åŸåˆ™

1. **é›¶åœæœºè¿ç§»**ï¼šåˆ†é˜¶æ®µè¿›è¡Œï¼Œç¡®ä¿ç³»ç»ŸæŒç»­å¯ç”¨
2. **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰æ•°æ®æ­£ç¡®è¿ç§»
3. **å‘åå…¼å®¹**ï¼šè¿ç§»æœŸé—´ä¿æŒ API å…¼å®¹
4. **å¯å›æ»š**ï¼šæä¾›å®Œæ•´çš„å›æ»šæ–¹æ¡ˆ

## ğŸ“Š é˜¶æ®µ 1ï¼šæ–°è¡¨ç»“æ„è®¾è®¡

### 1.1 åˆ›å»º `repair_orders` è¡¨

```sql
-- åˆ›å»ºæŠ¥ä¿®å·¥å•è¡¨
CREATE TABLE IF NOT EXISTS repair_orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  restaurant_id UUID NOT NULL REFERENCES restaurants(id),
  user_id UUID REFERENCES auth.users(id),
  
  -- æœåŠ¡ç±»å‹ï¼šç»´ä¿®æœåŠ¡ã€æ¸…æ´æœåŠ¡ã€å·¥ç¨‹æ”¹é€ 
  service_type TEXT NOT NULL DEFAULT 'ç»´ä¿®æœåŠ¡',
  CHECK (service_type IN ('ç»´ä¿®æœåŠ¡', 'æ¸…æ´æœåŠ¡', 'å·¥ç¨‹æ”¹é€ ')),
  
  -- å·¥å•çŠ¶æ€
  status TEXT NOT NULL DEFAULT 'pending',
  CHECK (status IN ('pending', 'processing', 'completed', 'cancelled')),
  
  -- å·¥å•å†…å®¹
  description TEXT,
  audio_url TEXT, -- è¯­éŸ³æŠ¥ä¿®URL
  device_id TEXT, -- è®¾å¤‡IDï¼ˆå¯é€‰ï¼‰
  urgency TEXT, -- ç´§æ€¥ç¨‹åº¦ï¼šlow, medium, high
  
  -- åˆ†é…ä¿¡æ¯
  assigned_to TEXT, -- åˆ†é…çš„å·¥äººID
  worker_id TEXT, -- å…¼å®¹å­—æ®µï¼ˆå·²åºŸå¼ƒï¼Œä¿ç•™ç”¨äºå…¼å®¹ï¼‰
  
  -- é‡‘é¢å’Œç¡®è®¤
  amount DECIMAL(10, 2) DEFAULT 0,
  customer_confirmed BOOLEAN DEFAULT false,
  
  -- å¤‡æ³¨
  notes TEXT,
  
  -- æ—¶é—´æˆ³
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- ç´¢å¼•
  CONSTRAINT fk_repair_restaurant FOREIGN KEY (restaurant_id) REFERENCES restaurants(id) ON DELETE CASCADE
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_repair_orders_restaurant_id ON repair_orders(restaurant_id);
CREATE INDEX idx_repair_orders_status ON repair_orders(status);
CREATE INDEX idx_repair_orders_service_type ON repair_orders(service_type);
CREATE INDEX idx_repair_orders_assigned_to ON repair_orders(assigned_to);
CREATE INDEX idx_repair_orders_created_at ON repair_orders(created_at DESC);

-- åˆ›å»ºæ›´æ–°æ—¶é—´è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_repair_orders_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_repair_orders_updated_at
  BEFORE UPDATE ON repair_orders
  FOR EACH ROW
  EXECUTE FUNCTION update_repair_orders_updated_at();
```

### 1.2 åˆ›å»º `delivery_orders` è¡¨

```sql
-- åˆ›å»ºç‡ƒæ–™é…é€è®¢å•è¡¨
CREATE TABLE IF NOT EXISTS delivery_orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  restaurant_id UUID NOT NULL REFERENCES restaurants(id),
  user_id UUID REFERENCES auth.users(id),
  
  -- äº§å“ç±»å‹
  product_type TEXT, -- äº§å“ç±»å‹ï¼ˆå¦‚ï¼šlpg, clean, alcoholç­‰ï¼‰
  service_type TEXT NOT NULL DEFAULT 'ç‡ƒæ–™é…é€',
  
  -- è®¢å•çŠ¶æ€
  status TEXT NOT NULL DEFAULT 'pending',
  CHECK (status IN ('pending', 'processing', 'delivering', 'completed', 'cancelled')),
  
  -- é…é€ä¿¡æ¯
  assigned_to TEXT, -- åˆ†é…çš„é…é€å‘˜ID
  worker_id TEXT, -- å…¼å®¹å­—æ®µï¼ˆå·²åºŸå¼ƒï¼Œä¿ç•™ç”¨äºå…¼å®¹ï¼‰
  tracking_code TEXT, -- æº¯æºç 
  proof_image TEXT, -- é…é€å‡­è¯å›¾ç‰‡
  
  -- é‡‘é¢å’Œç¡®è®¤
  amount DECIMAL(10, 2) DEFAULT 0,
  customer_confirmed BOOLEAN DEFAULT false,
  
  -- å¤‡æ³¨
  notes TEXT,
  
  -- æ—¶é—´æˆ³
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- ç´¢å¼•
  CONSTRAINT fk_delivery_restaurant FOREIGN KEY (restaurant_id) REFERENCES restaurants(id) ON DELETE CASCADE
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_delivery_orders_restaurant_id ON delivery_orders(restaurant_id);
CREATE INDEX idx_delivery_orders_status ON delivery_orders(status);
CREATE INDEX idx_delivery_orders_product_type ON delivery_orders(product_type);
CREATE INDEX idx_delivery_orders_assigned_to ON delivery_orders(assigned_to);
CREATE INDEX idx_delivery_orders_created_at ON delivery_orders(created_at DESC);

-- åˆ›å»ºæ›´æ–°æ—¶é—´è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_delivery_orders_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_delivery_orders_updated_at
  BEFORE UPDATE ON delivery_orders
  FOR EACH ROW
  EXECUTE FUNCTION update_delivery_orders_updated_at();
```

### 1.3 åˆ›å»º RLS ç­–ç•¥ï¼ˆRow Level Securityï¼‰

```sql
-- å¯ç”¨ RLS
ALTER TABLE repair_orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE delivery_orders ENABLE ROW LEVEL SECURITY;

-- repair_orders RLS ç­–ç•¥
-- ç­–ç•¥1ï¼šç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±é¤å…çš„æŠ¥ä¿®å·¥å•
CREATE POLICY "Users can view repair orders of their restaurant"
  ON repair_orders FOR SELECT
  USING (
    restaurant_id IN (
      SELECT id FROM restaurants WHERE user_id = auth.uid()
    )
  );

-- ç­–ç•¥2ï¼šç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå·±é¤å…çš„æŠ¥ä¿®å·¥å•
CREATE POLICY "Users can create repair orders for their restaurant"
  ON repair_orders FOR INSERT
  WITH CHECK (
    restaurant_id IN (
      SELECT id FROM restaurants WHERE user_id = auth.uid()
    )
  );

-- ç­–ç•¥3ï¼šç®¡ç†å‘˜å’Œåˆ†é…çš„å·¥äººå¯ä»¥æ›´æ–°æŠ¥ä¿®å·¥å•
CREATE POLICY "Admins and assigned workers can update repair orders"
  ON repair_orders FOR UPDATE
  USING (
    restaurant_id IN (
      SELECT id FROM restaurants WHERE user_id = auth.uid()
    )
    OR assigned_to = auth.uid()::TEXT
  );

-- delivery_orders RLS ç­–ç•¥
-- ç­–ç•¥1ï¼šç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±é¤å…çš„é…é€è®¢å•
CREATE POLICY "Users can view delivery orders of their restaurant"
  ON delivery_orders FOR SELECT
  USING (
    restaurant_id IN (
      SELECT id FROM restaurants WHERE user_id = auth.uid()
    )
  );

-- ç­–ç•¥2ï¼šç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå·±é¤å…çš„é…é€è®¢å•
CREATE POLICY "Users can create delivery orders for their restaurant"
  ON delivery_orders FOR INSERT
  WITH CHECK (
    restaurant_id IN (
      SELECT id FROM restaurants WHERE user_id = auth.uid()
    )
  );

-- ç­–ç•¥3ï¼šç®¡ç†å‘˜å’Œåˆ†é…çš„é…é€å‘˜å¯ä»¥æ›´æ–°é…é€è®¢å•
CREATE POLICY "Admins and assigned delivery workers can update delivery orders"
  ON delivery_orders FOR UPDATE
  USING (
    restaurant_id IN (
      SELECT id FROM restaurants WHERE user_id = auth.uid()
    )
    OR assigned_to = auth.uid()::TEXT
  );
```

## ğŸ“¦ é˜¶æ®µ 2ï¼šæ•°æ®è¿ç§»

### 2.1 æ•°æ®è¿ç§» SQL

```sql
-- å¼€å§‹äº‹åŠ¡
BEGIN;

-- è¿ç§»æŠ¥ä¿®å·¥å•æ•°æ®ï¼ˆservice_type ä¸º "ç»´ä¿®æœåŠ¡"ã€"æ¸…æ´æœåŠ¡"ã€"å·¥ç¨‹æ”¹é€ "ï¼‰
INSERT INTO repair_orders (
  id,
  restaurant_id,
  user_id,
  service_type,
  status,
  description,
  audio_url,
  device_id,
  urgency,
  assigned_to,
  worker_id,
  amount,
  customer_confirmed,
  notes,
  created_at,
  updated_at
)
SELECT 
  id,
  restaurant_id,
  user_id,
  service_type,
  status,
  description,
  audio_url,
  device_id,
  urgency,
  assigned_to,
  worker_id,
  amount,
  customer_confirmed,
  notes,
  created_at,
  updated_at
FROM orders
WHERE service_type IN ('ç»´ä¿®æœåŠ¡', 'æ¸…æ´æœåŠ¡', 'å·¥ç¨‹æ”¹é€ ')
ON CONFLICT (id) DO NOTHING;

-- è¿ç§»ç‡ƒæ–™é…é€è®¢å•æ•°æ®ï¼ˆservice_type ä¸º "ç‡ƒæ–™é…é€"ï¼‰
INSERT INTO delivery_orders (
  id,
  restaurant_id,
  user_id,
  product_type,
  service_type,
  status,
  assigned_to,
  worker_id,
  tracking_code,
  proof_image,
  amount,
  customer_confirmed,
  notes,
  created_at,
  updated_at
)
SELECT 
  id,
  restaurant_id,
  user_id,
  product_type,
  service_type,
  status,
  assigned_to,
  worker_id,
  tracking_code,
  proof_image,
  amount,
  customer_confirmed,
  notes,
  created_at,
  updated_at
FROM orders
WHERE service_type = 'ç‡ƒæ–™é…é€'
ON CONFLICT (id) DO NOTHING;

-- éªŒè¯è¿ç§»æ•°æ®é‡
DO $$
DECLARE
  repair_count INTEGER;
  delivery_count INTEGER;
  total_orders INTEGER;
BEGIN
  SELECT COUNT(*) INTO repair_count FROM repair_orders;
  SELECT COUNT(*) INTO delivery_count FROM delivery_orders;
  SELECT COUNT(*) INTO total_orders FROM orders 
    WHERE service_type IN ('ç»´ä¿®æœåŠ¡', 'æ¸…æ´æœåŠ¡', 'å·¥ç¨‹æ”¹é€ ', 'ç‡ƒæ–™é…é€');
  
  RAISE NOTICE 'æŠ¥ä¿®å·¥å•è¿ç§»æ•°é‡: %', repair_count;
  RAISE NOTICE 'é…é€è®¢å•è¿ç§»æ•°é‡: %', delivery_count;
  RAISE NOTICE 'åŸå§‹è®¢å•æ€»æ•°: %', total_orders;
  
  IF repair_count + delivery_count != total_orders THEN
    RAISE EXCEPTION 'æ•°æ®è¿ç§»ä¸å®Œæ•´ï¼æŠ¥ä¿®: %, é…é€: %, æ€»è®¡: %', 
      repair_count, delivery_count, total_orders;
  END IF;
END $$;

-- æäº¤äº‹åŠ¡
COMMIT;
```

### 2.2 æ•°æ®éªŒè¯æŸ¥è¯¢

```sql
-- éªŒè¯æŠ¥ä¿®å·¥å•è¿ç§»
SELECT 
  'repair_orders' as table_name,
  COUNT(*) as total_count,
  COUNT(DISTINCT restaurant_id) as restaurant_count,
  COUNT(DISTINCT service_type) as service_type_count,
  COUNT(*) FILTER (WHERE status = 'pending') as pending_count,
  COUNT(*) FILTER (WHERE status = 'completed') as completed_count
FROM repair_orders;

-- éªŒè¯é…é€è®¢å•è¿ç§»
SELECT 
  'delivery_orders' as table_name,
  COUNT(*) as total_count,
  COUNT(DISTINCT restaurant_id) as restaurant_count,
  COUNT(DISTINCT product_type) as product_type_count,
  COUNT(*) FILTER (WHERE status = 'pending') as pending_count,
  COUNT(*) FILTER (WHERE status = 'completed') as completed_count
FROM delivery_orders;

-- å¯¹æ¯”åŸå§‹ orders è¡¨
SELECT 
  'orders (original)' as table_name,
  COUNT(*) as total_count,
  COUNT(*) FILTER (WHERE service_type IN ('ç»´ä¿®æœåŠ¡', 'æ¸…æ´æœåŠ¡', 'å·¥ç¨‹æ”¹é€ ')) as repair_count,
  COUNT(*) FILTER (WHERE service_type = 'ç‡ƒæ–™é…é€') as delivery_count
FROM orders;
```

## ğŸ”§ é˜¶æ®µ 3ï¼šAPI ä¿®æ”¹æ¸…å•

### 3.1 æŠ¥ä¿®å·¥å•ç›¸å…³ API

#### æ–‡ä»¶ï¼š`app/api/repair/create/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("repair_orders")`
- **ä½ç½®**ï¼šç¬¬ 222 è¡Œ
- **å½±å“**ï¼šåˆ›å»ºæŠ¥ä¿®å·¥å•

#### æ–‡ä»¶ï¼š`app/api/repair/list/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("repair_orders")`
- **ä½ç½®**ï¼šç¬¬ 40 è¡Œ
- **å½±å“**ï¼šæŸ¥è¯¢æŠ¥ä¿®å·¥å•åˆ—è¡¨
- **æ³¨æ„**ï¼šç§»é™¤ `service_type` è¿‡æ»¤é€»è¾‘ï¼ˆå› ä¸ºè¡¨å·²ç»åˆ†ç¦»ï¼‰

#### æ–‡ä»¶ï¼š`app/api/repair/update/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("repair_orders")`
- **ä½ç½®**ï¼šç¬¬ 92 è¡Œã€ç¬¬ 140 è¡Œ
- **å½±å“**ï¼šæ›´æ–°æŠ¥ä¿®å·¥å•çŠ¶æ€

### 3.2 ç‡ƒæ–™é…é€è®¢å•ç›¸å…³ API

#### æ–‡ä»¶ï¼š`app/api/orders/create/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("delivery_orders")`
- **ä½ç½®**ï¼šç¬¬ 90 è¡Œ
- **å½±å“**ï¼šåˆ›å»ºç‡ƒæ–™é…é€è®¢å•
- **æ³¨æ„**ï¼šç§»é™¤ `service_type` å­—æ®µï¼ˆå› ä¸ºè¡¨å·²ç»å›ºå®šä¸º"ç‡ƒæ–™é…é€"ï¼‰

#### æ–‡ä»¶ï¼š`app/api/orders/pending/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("delivery_orders")`
- **ä½ç½®**ï¼šç¬¬ 42 è¡Œ
- **å½±å“**ï¼šæŸ¥è¯¢å¾…æ¥å•è®¢å•åˆ—è¡¨
- **æ³¨æ„**ï¼šç§»é™¤ `service_type` è¿‡æ»¤

#### æ–‡ä»¶ï¼š`app/api/orders/accept/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("delivery_orders")`
- **ä½ç½®**ï¼šç¬¬ 46 è¡Œã€ç¬¬ 68 è¡Œ
- **å½±å“**ï¼šé…é€å‘˜æ¥å•

#### æ–‡ä»¶ï¼š`app/api/orders/dispatch/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("delivery_orders")`
- **ä½ç½®**ï¼šç¬¬ 50 è¡Œã€ç¬¬ 72 è¡Œ
- **å½±å“**ï¼šé…é€å‘˜æ´¾å•

#### æ–‡ä»¶ï¼š`app/api/orders/complete/route.ts`
- **ä¿®æ”¹**ï¼šå°† `.from("orders")` æ”¹ä¸º `.from("delivery_orders")`
- **ä½ç½®**ï¼šç¬¬ 55 è¡Œã€ç¬¬ 77 è¡Œ
- **å½±å“**ï¼šå®Œæˆé…é€

### 3.3 å…¶ä»–ç›¸å…³ API

#### æ–‡ä»¶ï¼š`app/api/payment/alipay/notify/route.ts`
- **ä¿®æ”¹**ï¼šéœ€è¦åˆ¤æ–­è®¢å•ç±»å‹ï¼Œåˆ†åˆ«æ›´æ–° `repair_orders` æˆ– `delivery_orders`
- **ä½ç½®**ï¼šç¬¬ 40 è¡Œã€ç¬¬ 69 è¡Œ
- **å½±å“**ï¼šæ”¯ä»˜å›è°ƒæ›´æ–°è®¢å•çŠ¶æ€
- **æ³¨æ„**ï¼šéœ€è¦æ ¹æ®è®¢å•IDæŸ¥è¯¢åŸ `orders` è¡¨ç¡®å®šç±»å‹ï¼Œæˆ–ç»´æŠ¤æ˜ å°„è¡¨

#### æ–‡ä»¶ï¼š`app/api/filling/route.ts`
- **ä¿®æ”¹**ï¼šå°†æ›´æ–° `orders` è¡¨æ”¹ä¸ºæ›´æ–° `delivery_orders` è¡¨
- **ä½ç½®**ï¼šç¬¬ 260 è¡Œã€ç¬¬ 269 è¡Œ
- **å½±å“**ï¼šé…é€å®Œæˆåæ›´æ–°è®¢å•çŠ¶æ€

## ğŸ“ é˜¶æ®µ 4ï¼šè¿ç§»æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1ï¼šå‡†å¤‡é˜¶æ®µï¼ˆç»´æŠ¤çª—å£å‰ï¼‰

1. **å¤‡ä»½æ•°æ®åº“**
   ```sql
   -- åœ¨ Supabase Dashboard æ‰§è¡Œå®Œæ•´å¤‡ä»½
   -- æˆ–ä½¿ç”¨ pg_dump
   ```

2. **åˆ›å»ºè¿ç§»è„šæœ¬æ–‡ä»¶**
   - åˆ›å»º `migrations/20250120_split_orders_table.sql`
   - åŒ…å«æ‰€æœ‰ DDL å’Œ DML è¯­å¥

3. **åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯**
   - åœ¨æµ‹è¯•æ•°æ®åº“æ‰§è¡Œå®Œæ•´è¿ç§»
   - éªŒè¯æ•°æ®å®Œæ•´æ€§
   - æµ‹è¯•æ‰€æœ‰ API åŠŸèƒ½

### æ­¥éª¤ 2ï¼šæ‰§è¡Œè¿ç§»ï¼ˆç»´æŠ¤çª—å£ï¼‰

1. **åˆ›å»ºæ–°è¡¨**
   ```sql
   -- æ‰§è¡Œé˜¶æ®µ 1 çš„ SQLï¼ˆåˆ›å»ºè¡¨ã€ç´¢å¼•ã€è§¦å‘å™¨ï¼‰
   ```

2. **è¿ç§»æ•°æ®**
   ```sql
   -- æ‰§è¡Œé˜¶æ®µ 2 çš„ SQLï¼ˆæ•°æ®è¿ç§»ï¼‰
   ```

3. **éªŒè¯æ•°æ®**
   ```sql
   -- æ‰§è¡Œé˜¶æ®µ 2.2 çš„éªŒè¯æŸ¥è¯¢
   ```

### æ­¥éª¤ 3ï¼šä»£ç éƒ¨ç½²ï¼ˆç»´æŠ¤çª—å£ï¼‰

1. **éƒ¨ç½²æ–°ä»£ç **
   - ä¿®æ”¹æ‰€æœ‰ API æ–‡ä»¶ï¼ˆé˜¶æ®µ 3ï¼‰
   - éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
   - é‡å¯æœåŠ¡

2. **éªŒè¯åŠŸèƒ½**
   - æµ‹è¯•åˆ›å»ºæŠ¥ä¿®å·¥å•
   - æµ‹è¯•åˆ›å»ºé…é€è®¢å•
   - æµ‹è¯•æŸ¥è¯¢åˆ—è¡¨
   - æµ‹è¯•æ›´æ–°çŠ¶æ€

### æ­¥éª¤ 4ï¼šæ¸…ç†é˜¶æ®µï¼ˆè¿ç§»æˆåŠŸåï¼‰

1. **ä¿ç•™åŸè¡¨ä¸€æ®µæ—¶é—´**ï¼ˆå»ºè®® 30 å¤©ï¼‰
   - ä½œä¸ºå¤‡ä»½å’Œå›æ»šå‡†å¤‡
   - ç›‘æ§æ˜¯å¦æœ‰é—æ¼çš„æŸ¥è¯¢

2. **ç§»é™¤åŸè¡¨**ï¼ˆç¡®è®¤æ— é—®é¢˜åï¼‰
   ```sql
   -- 30 å¤©åæ‰§è¡Œ
   -- æ³¨æ„ï¼šå…ˆç¡®è®¤æ²¡æœ‰ä»£ç å†ä½¿ç”¨ orders è¡¨
   DROP TABLE IF EXISTS orders CASCADE;
   ```

## ğŸ”„ é˜¶æ®µ 5ï¼šå›æ»šæ–¹æ¡ˆ

### 5.1 å›æ»šæ¡ä»¶

å¦‚æœè¿ç§»åå‘ç°é—®é¢˜ï¼Œéœ€è¦å›æ»šï¼š
- æ•°æ®ä¸¢å¤±æˆ–ä¸ä¸€è‡´
- API åŠŸèƒ½å¼‚å¸¸
- æ€§èƒ½ä¸¥é‡ä¸‹é™

### 5.2 å›æ»šæ­¥éª¤

1. **æ¢å¤ä»£ç **
   - å›æ»šåˆ°è¿ç§»å‰çš„ä»£ç ç‰ˆæœ¬
   - æ‰€æœ‰ API æ¢å¤ä½¿ç”¨ `orders` è¡¨

2. **æ¢å¤æ•°æ®**ï¼ˆå¦‚æœéœ€è¦ï¼‰
   ```sql
   -- å¦‚æœæ–°è¡¨æ•°æ®æœ‰é—®é¢˜ï¼Œä»å¤‡ä»½æ¢å¤ orders è¡¨
   -- æˆ–ä»æ–°è¡¨å›å†™æ•°æ®åˆ° orders è¡¨
   ```

3. **åˆ é™¤æ–°è¡¨**ï¼ˆå¯é€‰ï¼‰
   ```sql
   DROP TABLE IF EXISTS repair_orders CASCADE;
   DROP TABLE IF EXISTS delivery_orders CASCADE;
   ```

## âœ… é˜¶æ®µ 6ï¼šæµ‹è¯•æ£€æŸ¥æ¸…å•

### 6.1 åŠŸèƒ½æµ‹è¯•

- [ ] åˆ›å»ºæŠ¥ä¿®å·¥å•ï¼ˆç»´ä¿®æœåŠ¡ï¼‰
- [ ] åˆ›å»ºæŠ¥ä¿®å·¥å•ï¼ˆæ¸…æ´æœåŠ¡ï¼‰
- [ ] åˆ›å»ºæŠ¥ä¿®å·¥å•ï¼ˆå·¥ç¨‹æ”¹é€ ï¼‰
- [ ] åˆ›å»ºç‡ƒæ–™é…é€è®¢å•
- [ ] æŸ¥è¯¢æŠ¥ä¿®å·¥å•åˆ—è¡¨
- [ ] æŸ¥è¯¢é…é€è®¢å•åˆ—è¡¨
- [ ] æ›´æ–°æŠ¥ä¿®å·¥å•çŠ¶æ€
- [ ] æ›´æ–°é…é€è®¢å•çŠ¶æ€
- [ ] é…é€å‘˜æ¥å•
- [ ] é…é€å‘˜æ´¾å•
- [ ] å®Œæˆé…é€
- [ ] æ”¯ä»˜å›è°ƒæ›´æ–°è®¢å•

### 6.2 æ•°æ®å®Œæ•´æ€§æµ‹è¯•

- [ ] éªŒè¯æ‰€æœ‰æŠ¥ä¿®å·¥å•æ•°æ®å·²è¿ç§»
- [ ] éªŒè¯æ‰€æœ‰é…é€è®¢å•æ•°æ®å·²è¿ç§»
- [ ] éªŒè¯æ•°æ®æ•°é‡ä¸€è‡´
- [ ] éªŒè¯å…³é”®å­—æ®µå®Œæ•´
- [ ] éªŒè¯å…³è”å…³ç³»æ­£ç¡®

### 6.3 æ€§èƒ½æµ‹è¯•

- [ ] æŸ¥è¯¢åˆ—è¡¨å“åº”æ—¶é—´
- [ ] åˆ›å»ºè®¢å•å“åº”æ—¶é—´
- [ ] æ›´æ–°è®¢å•å“åº”æ—¶é—´
- [ ] æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

### 6.4 æƒé™æµ‹è¯•

- [ ] RLS ç­–ç•¥æ­£å¸¸å·¥ä½œ
- [ ] ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±é¤å…çš„è®¢å•
- [ ] å·¥äººåªèƒ½æ›´æ–°åˆ†é…çš„è®¢å•
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è®¢å•

## ğŸ“‹ è¿ç§»æ—¶é—´è¡¨å»ºè®®

| é˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| å‡†å¤‡é˜¶æ®µ | 1-2 å¤© | åˆ›å»ºè„šæœ¬ã€æµ‹è¯•ç¯å¢ƒéªŒè¯ |
| æ‰§è¡Œè¿ç§» | 2-4 å°æ—¶ | ç»´æŠ¤çª—å£ï¼Œæ‰§è¡Œè¿ç§» |
| ä»£ç éƒ¨ç½² | 30 åˆ†é’Ÿ | éƒ¨ç½²æ–°ä»£ç ã€é‡å¯æœåŠ¡ |
| éªŒè¯æµ‹è¯• | 1-2 å°æ—¶ | åŠŸèƒ½æµ‹è¯•ã€æ•°æ®éªŒè¯ |
| ç›‘æ§è§‚å¯Ÿ | 7 å¤© | ç›‘æ§ç³»ç»Ÿè¿è¡Œæƒ…å†µ |
| æ¸…ç†é˜¶æ®µ | 30 å¤©å | åˆ é™¤åŸè¡¨ï¼ˆç¡®è®¤æ— é—®é¢˜åï¼‰ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**ï¼šè¿ç§»æœŸé—´ç¡®ä¿æ²¡æœ‰æ–°æ•°æ®å†™å…¥ `orders` è¡¨
2. **API å…¼å®¹æ€§**ï¼šè¿ç§»åç«‹å³éƒ¨ç½²æ–°ä»£ç ï¼Œé¿å…æ–°æ—§ä»£ç æ··ç”¨
3. **ç›‘æ§å‘Šè­¦**ï¼šè¿ç§»åå¯†åˆ‡ç›‘æ§é”™è¯¯æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡
4. **å¤‡ä»½ä¿ç•™**ï¼šä¿ç•™åŸè¡¨è‡³å°‘ 30 å¤©ï¼Œç¡®ä¿å¯ä»¥å›æ»š
5. **é€šçŸ¥ç”¨æˆ·**ï¼šæå‰é€šçŸ¥ç”¨æˆ·ç»´æŠ¤çª—å£æ—¶é—´

## ğŸ“ æ”¯æŒè”ç³»

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
2. éªŒè¯æ•°æ®å®Œæ•´æ€§
3. æ‰§è¡Œå›æ»šæ–¹æ¡ˆï¼ˆå¦‚éœ€è¦ï¼‰
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**è¿ç§»è®¡åˆ’ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-20  
**æœ€åæ›´æ–°**ï¼š2025-01-20
