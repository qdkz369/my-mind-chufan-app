# .env.local 文件检查清单

## ✅ 必需的 Supabase 环境变量（3个）

根据代码修复后的要求，`.env.local` 文件**必须**包含以下 3 个 Supabase 环境变量：

```env
NEXT_PUBLIC_SUPABASE_URL=你的Supabase项目URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=你的Supabase Anon Key
SUPABASE_SERVICE_ROLE_KEY=你的Supabase Service Role Key
```

### 检查要点：

1. **变量名必须完全匹配**（区分大小写）
   - ✅ `NEXT_PUBLIC_SUPABASE_URL`（正确）
   - ❌ `NEXT_PUBLIC_SUPABASE_url`（错误，大小写不匹配）
   - ❌ `SUPABASE_URL`（错误，缺少 `NEXT_PUBLIC_` 前缀）

2. **格式要求**
   - ✅ `变量名=值`（等号两边可以有空格，但建议不要有）
   - ❌ `变量名 = 值`（有空格，虽然可以工作但不推荐）
   - ❌ `变量名="值"`（值不需要引号，除非值本身包含特殊字符）

3. **值不能为空**
   - ✅ `NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co`
   - ❌ `NEXT_PUBLIC_SUPABASE_URL=`（值为空）

## 📋 其他可能的环境变量

根据项目代码，可能还需要：

```env
NEXT_PUBLIC_AMAP_SECURITY_KEY=你的高德地图密钥
```

## 🔍 常见问题检查

### 问题 1：缺少必需的环境变量

**症状：**
- API 返回 "服务器配置错误"
- 控制台显示 "Supabase URL 或密钥未配置"

**解决方法：**
确保所有 3 个 Supabase 变量都存在且不为空。

### 问题 2：环境变量名称错误

**症状：**
- 变量存在但代码读取不到

**检查：**
- `NEXT_PUBLIC_SUPABASE_URL`（不是 `SUPABASE_URL`）
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`（不是 `SUPABASE_ANON_KEY`）
- `SUPABASE_SERVICE_ROLE_KEY`（注意：这个**没有** `NEXT_PUBLIC_` 前缀）

### 问题 3：值包含特殊字符

**症状：**
- 环境变量读取失败

**解决方法：**
如果值包含空格或特殊字符，使用引号：
```env
NEXT_PUBLIC_SUPABASE_URL="https://xxx.supabase.co"
```

### 问题 4：文件位置错误

**症状：**
- 环境变量不生效

**检查：**
- 文件必须在项目根目录（与 `package.json` 同级）
- 文件名必须是 `.env.local`（注意前面的点）

### 问题 5：未重启开发服务器

**症状：**
- 修改环境变量后不生效

**解决方法：**
1. 停止开发服务器（`Ctrl + C`）
2. 重新启动：`npm run dev`

## 📝 标准 .env.local 文件示例

```env
# Supabase 配置（必需）
NEXT_PUBLIC_SUPABASE_URL=https://gjlhcpfvjgqabqanvgmu.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=sb_publishable_OQSB-t8qr1xO0WRcpVSIZA_O4RFkAHQ
SUPABASE_SERVICE_ROLE_KEY=sb_secret_Nf3MT3QFxzXzr60Myh6VwA_K3-II_Nd

# 高德地图配置（可选）
NEXT_PUBLIC_AMAP_SECURITY_KEY=ce1bde649b433cf6dbd4343190a6009a
```

## ⚠️ 重要提示

1. **不要提交 `.env.local` 到 Git**
   - 该文件已在 `.gitignore` 中
   - 包含敏感信息，不应版本控制

2. **生产环境配置**
   - 在部署平台（如 Vercel）的环境变量设置中配置
   - 不要在生产环境使用 `.env.local`

3. **变量前缀说明**
   - `NEXT_PUBLIC_` 前缀的变量会暴露到客户端代码
   - `SUPABASE_SERVICE_ROLE_KEY` 没有前缀，只在服务端可用（更安全）

## 🔧 验证方法

### 方法 1：查看服务器日志

启动开发服务器后，查看终端输出，应该能看到：
```
[创建公司API] 环境变量检查:
NEXT_PUBLIC_SUPABASE_URL 存在: true
NEXT_PUBLIC_SUPABASE_ANON_KEY 存在: true
SUPABASE_SERVICE_ROLE_KEY 存在: true
```

### 方法 2：测试功能

- 尝试登录（需要 `NEXT_PUBLIC_SUPABASE_URL` 和 `NEXT_PUBLIC_SUPABASE_ANON_KEY`）
- 尝试创建供应商（需要 `SUPABASE_SERVICE_ROLE_KEY`）

如果功能正常，说明环境变量配置正确。

---

**如果您的 `.env.local` 文件只有 1-4 行，请确保至少包含上述 3 个必需的 Supabase 变量。**
